<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bancolombia - Crear Nuevo Proyecto</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            /* ===== Colores principales (grises equivalentes) ===== */
            --bancolombia-blue: #2C2A29;        
            --bancolombia-light-blue: #5A5A5A;   
            --bancolombia-green: #707070;       
            --bancolombia-yellow: #D9D9D9;       

            /* ===== Neutrales ===== */
            --bancolombia-gray: #F5F5F5;         
            --bancolombia-dark-gray: #1E1E1E;     
            --text-secondary: #5A5A5A;            
            --border-light: #E0E0E0;             
            --pure-white: #FFFFFF;               
        }
        
        body {
            font-family: "Cambria", serif;
            font-size: 18px;
            background-color: var(--bancolombia-gray);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 1. Botón Primario (Azul original → Gris oscuro) */
        .btn-primary {
            background-color: var(--bancolombia-blue);
            color: var(--pure-white);
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-primary:hover {
            background-color: #1E1E1E; /* 10% más oscuro al hover */
        }
        
        .header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .logo-container img {
            height: 50px;
        }
        
        .crear-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            color: var(--bancolombia-blue);
            border-bottom: 2px solid var(--bancolombia-light-blue);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .btn-bancolombia {
            background-color: var(--bancolombia-blue);
            color: white;
        }
        
        .btn-bancolombia:hover {
            background-color: var(--bancolombia-light-blue);
            color: white;
        }
        
        .form-section {
            border-left: 4px solid var(--bancolombia-light-blue);
            padding-left: 15px;
            margin-bottom: 30px;
        }
        
        .required-field::after {
            content: " *";
            color: red;
        }
        
        .participante-item {
            background-color: var(--bancolombia-gray);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .remove-participante {
            position: absolute;
            right: 10px;
            top: 10px;
            color: var(--bancolombia-red);
            cursor: pointer;
        }
        .footer {
            background-color: var(--bancolombia-blue);
            color: white;
            padding: 20px 0;
            text-align: center;
            font-size: 0.9rem;
            margin-top: 40px;
        }
        
        .footer a {
            color: var(--bancolombia-yellow);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }

        .user-info {
            text-align: right;
            padding: 10px 20px;
            background-color: var(--bancolombia-gray);
            color: var(--bancolombia-dark-gray);
            font-size: 0.9rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        /* Ajustes para mejor alineación */
        .container-aligned {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }
        .breadcrumb {
            background-color: transparent;
            padding: 0;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .breadcrumb-item.active {
            color: var(--bancolombia-blue);
            font-weight: 600;
        }
         /* Efecto hover para el logo */
         .logo-container img:hover {
            transform: scale(1.05);
        }
        .logo-container {
            text-align: center;
            padding: 10px 0;
            margin: 0 auto;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .alert-required {
            border: 1px solid #ff4444 !important;
        }
         /* Añadir este estilo para ajustar el z-index de los dropdowns */
        .choices__list--dropdown {
            z-index: 1000 !important;
        }
        /* Añadir esto a tu CSS */
        .is-invalid {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
        }
</style>
<link rel="shortcut icon" href="{{ url_for('static', filename='LogoBancolombia.ico') }}">

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx-calc@0.7.0/lib/xlsx-calc.js"></script>

</head>
<body>
    <!-- Header con logo y usuario -->
    <div class="header">
        <div class="container-aligned">
            <div class="user-info">
                <span class="role-badge me-3">{{ session.usuario.rol | title }}</span>
                <i class="fas fa-user-circle"></i> {{ session.usuario.nombre }}
                | <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a>
            </div>
            <div class="logo-container">
                <img src="https://www.uam.edu.co/wp-content/uploads/2022/09/logo-bancolombia1.png" 
                     alt="Bancolombia">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('menu_principal') }}"><i class="fas fa-home"></i> Menú Principal</a></li>
                        <li class="breadcrumb-item active" aria-current="page"><i class="fas fa-user-tie"></i> Módulo Pilotos</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3"><i class="fas fa-plus-circle me-2"></i> Crear Nuevo Proyecto</h1>
            <a href="{{ url_for('modulo_pilotos') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Volver
            </a>
        </div>
        
        <!-- Formulario de creación -->
        <div class="container">
            <form id="form-crear-proyecto">
                {# {% if session.usuario.rol in ['admin', 'arquitecto'] %} #}
                <!-- Sección 1: Datos Básicos -->
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-info-circle me-2"></i>Datos Básicos del Proyecto</h2>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">ID Proyecto</label>
                            <input type="number" class="form-control" name="id_proyecto" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tipo de Crédito</label>
                            <select class="form-select" name="tipo_credito">
                                <option value="">Seleccione un tipo</option>
                                <option value="CPI">CPI</option>
                                <option value="CPP">CPP</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tipo de Producto</label>
                            <select class="form-select" id="tipo_producto" name="tipo_producto">
                                <option value="">Seleccione un producto</option>
                                <option value="CPI CONSTRUCTOR">CPI CONSTRUCTOR</option>
                                <option value="CPP CONSTRUCTOR">CPP CONSTRUCTOR</option>
                                <option value="VIS CONSTRUCTOR">VIS CONSTRUCTOR</option>
                                <option value="VIS CIEN MIL VIVIENDAS">VIS CIEN MIL VIVIENDAS</option>
                                <option value="VIS LINEA VERDE">VIS LINEA VERDE</option>
                                <option value="NO VIS CONSTRUCTOR">NO VIS CONSTRUCTOR</option>
                                <option value="NO VIS LINEA VERDE">NO VIS LINEA VERDE</option>
                                <option value="DIF VVDA CONSTRUCTOR">DIF VVDA CONSTRUCTOR</option>
                                <option value="DIF VVDA LINEA VERDE">DIF VVDA LINEA VERDE</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Grupo de Riesgo (Carpeta Gerencial)</label>
                            <input list="grupo_de_riesgo-list" class="form-select" name="grupo_riesgo" id="grupo_riesgoInput">
                            

                            <datalist id="grupo_de_riesgo-list">
                                <option value="">Seleccione un grupo de riesgo</option>
                                <option value="AB INGENIERIA SAS">AB INGENIERIA SAS</option>
                                <option value="ACIERTO INMOBILIARIO SA">ACIERTO INMOBILIARIO SA</option>
                                <option value="AED CONSTRUCTORES SAS">AED CONSTRUCTORES SAS</option>
                                <option value="A+C CONSTRUCTORA">A+C CONSTRUCTORA</option>
                                <option value="A2 CONSTRUCTORA SAS">A2 CONSTRUCTORA SAS</option>
                                <option value="A3 COUNSULTING">A3 COUNSULTING</option>
                                <option value="ACRECER">ACRECER</option>
                                <option value="ACTUAL COLOMBIA SAS">ACTUAL COLOMBIA SAS</option>
                                <option value="AKILA SAS">AKILA SAS</option>
                                <option value="ALCANTARA CONSTRUCTORA SAS">ALCANTARA CONSTRUCTORA SAS</option>
                                <option value="AMARILO SAS">AMARILO SAS</option>
                                <option value="AMBIENTTI CONSTRUCTORA INMOBILIARIA">AMBIENTTI CONSTRUCTORA INMOBILIARIA</option>
                                <option value="ANDES DESARROLLADORA S.A.S.">ANDES DESARROLLADORA S.A.S.</option>
                                <option value="AP INGENIERÍA LTDA">AP INGENIERÍA LTDA</option>
                                <option value="ARANJUEZ CONSTRUCCIONES INMOBILIARIAS">ARANJUEZ CONSTRUCCIONES INMOBILIARIAS</option>
                                <option value="AREA CUADRADA">AREA CUADRADA</option>
                                <option value="AREA URBANA DISEÑO Y CONSTRUCCION SAS">AREA URBANA DISEÑO Y CONSTRUCCION SAS</option>
                                <option value="ARIAS SERNA Y SARAVIA">ARIAS SERNA Y SARAVIA</option>
                                <option value="ARKTEC CONSTRUCTORA SAS">ARKTEC CONSTRUCTORA SAS</option>
                                <option value="ARQUIAMBIENTAL SAS">ARQUIAMBIENTAL SAS</option>
                                <option value="ARQUIURBE LTDA">ARQUIURBE LTDA</option>
                                <option value="ARQUITECTOS CONSTRUCTORES ASOCIADOS">ARQUITECTOS CONSTRUCTORES ASOCIADOS</option>
                                <option value="ARQUITECTURA Y CONCRETO">ARQUITECTURA Y CONCRETO</option>
                                <option value="ARVINCO">ARVINCO</option>
                                <option value="ASUL SAS">ASUL SAS</option>
                                <option value="ATLANTIS CONSTRUCTORA LTDA">ATLANTIS CONSTRUCTORA LTDA</option>
                                <option value="AVENIDA COLOMBIA PEF">AVENIDA COLOMBIA PEF</option>
                                <option value="A UNO PROMOTORES">A UNO PROMOTORES</option>
                                <option value="BASA CONSTRUCCIONES SAS">BASA CONSTRUCCIONES SAS</option>
                                <option value="BESCO COLOMBIA SAS">BESCO COLOMBIA SAS</option>
                                <option value="BIENES Y BIENES SA">BIENES Y BIENES SA</option>
                                <option value="BOHIOS URBANOS SAS">BOHIOS URBANOS SAS</option>
                                <option value="BRAZZO CONSTRUCTORES">BRAZZO CONSTRUCTORES</option>
                                <option value="BREK SAS">BREK SAS</option>
                                <option value="BRICCON SAS">BRICCON SAS</option>
                                <option value="C.A.S.A.">C.A.S.A.</option>
                                <option value="CA VENTURES COLOMBIA S.A.S.">CA VENTURES COLOMBIA S.A.S.</option>
                                <option value="CADINCO">CADINCO</option>
                                <option value="CANALES DESARROLLADORES S.A.S">CANALES DESARROLLADORES S.A.S</option>
                                <option value="CANO H INGENIERIA S.A.S">CANO H INGENIERIA S.A.S</option>
                                <option value="CASACTIVA">CASACTIVA</option>
                                <option value="CGR INGENIERIA Y GERENCIA DE PROYECTOS SAS">CGR INGENIERIA Y GERENCIA DE PROYECTOS SAS</option>
                                <option value="CG CONSTRUCTORA S.A.S">CG CONSTRUCTORA S.A.S</option>
                                <option value="CHACÓN CONSTRUCCIONES SAS">CHACÓN CONSTRUCCIONES SAS</option>
                                <option value="CINCO URBANA SAS">CINCO URBANA SAS</option>
                                <option value="CNV CONSTRUCCIONES SAS">CNV CONSTRUCCIONES SAS</option>
                                <option value="COALA ARQUITECTURA Y CONSTRUCCION">COALA ARQUITECTURA Y CONSTRUCCION</option>
                                <option value="COENCO">COENCO</option>
                                <option value="COHALA CONSTRUCCIONES S.A.S.">COHALA CONSTRUCCIONES S.A.S.</option>
                                <option value="COINGSA S.A.S">COINGSA S.A.S</option>
                                <option value="COLOMBIANA DE CONSTRUCCIONES SAS">COLOMBIANA DE CONSTRUCCIONES SAS</option>
                                <option value="CONACIERTO INGENIERIA ARQUITECTURA S.A.S">CONACIERTO INGENIERIA ARQUITECTURA S.A.S</option>
                                <option value="CONALTURA S.A.">CONALTURA S.A.</option>
                                <option value="CONASEL INGENIERIA S.A.S.">CONASEL INGENIERIA S.A.S.</option>
                                <option value="CONENCO">CONENCO</option>
                                <option value="CONEXO INMOBILIARIO SAS">CONEXO INMOBILIARIO SAS</option>
                                <option value="CONIGSA">CONIGSA</option>
                                <option value="CONINSA SAS">CONINSA SAS</option>
                                <option value="CONINTEL S.A.">CONINTEL S.A.</option>
                                <option value="CONSTRUCCIONES BUEN VIVIR S.A.">CONSTRUCCIONES BUEN VIVIR S.A.</option>
                                <option value="CONSTRUCCIONES CARAN S.A.S">CONSTRUCCIONES CARAN S.A.S</option>
                                <option value="CONSTRUCCIONES CFC Y ASOCIADOS">CONSTRUCCIONES CFC Y ASOCIADOS</option>
                                <option value="CONSTRUCCIONES MACRO S.A.S">CONSTRUCCIONES MACRO S.A.S</option>
                                <option value="CONSTRUCCIONES RIVAS MORA SAS">CONSTRUCCIONES RIVAS MORA SAS</option>
                                <option value="CONSTRUCCIONES RCG">CONSTRUCCIONES RCG</option>
                                <option value="CONSTRUCCIONES URBANAS S.A.S.">CONSTRUCCIONES URBANAS S.A.S.</option>
                                <option value="CONSTRUCCIONES Y NEGOCIOS SYLCO S.A.S.">CONSTRUCCIONES Y NEGOCIOS SYLCO S.A.S.</option>
                                <option value="CONSTRUCCIONES Y URBANIZACIONES SAS">CONSTRUCCIONES Y URBANIZACIONES SAS</option>
                                <option value="CONSTRUMAX">CONSTRUMAX</option>
                                <option value="CONSTRUCTORA 1A S.A.S">CONSTRUCTORA 1A S.A.S</option>
                                <option value="CONSTRUCTORA ALHAMBRA - FORJAR">CONSTRUCTORA ALHAMBRA - FORJAR</option>
                                <option value="CONSTRUCTORA ALPES S.A">CONSTRUCTORA ALPES S.A</option>
                                <option value="CONSTRUCTORA ARQUIMEG">CONSTRUCTORA ARQUIMEG</option>
                                <option value="CONSTRUCTORA ASCENSO">CONSTRUCTORA ASCENSO</option>
                                <option value="CONSTRUCTORA BALCONES S.A.S">CONSTRUCTORA BALCONES S.A.S</option>
                                <option value="CONSTRUCTORA BOLIVAR CALI S.A.">CONSTRUCTORA BOLIVAR CALI S.A.</option>
                                <option value="CONSTRUCTORA BOLIVAR S.A.">CONSTRUCTORA BOLIVAR S.A.</option>
                                <option value="CONSTRUCTORA CANALKI S.A.S">CONSTRUCTORA CANALKI S.A.S</option>
                                <option value="CONSTRUCTORA CAPITAL BOGOTA">CONSTRUCTORA CAPITAL BOGOTA</option>
                                <option value="CONSTRUCTORA CAPITAL MEDELLÍN">CONSTRUCTORA CAPITAL MEDELLÍN</option>
                                <option value="CONSTRUCTORA CARVAJAL Y RIVERA SAS">CONSTRUCTORA CARVAJAL Y RIVERA SAS</option>
                                <option value="CONSTRUCTORA CONFUTURO">CONSTRUCTORA CONFUTURO</option>
                                <option value="CONSTRUCTORA CONCONCRETO">CONSTRUCTORA CONCONCRETO</option>
                                <option value="CONSTRUCTORA CONTEX SAS">CONSTRUCTORA CONTEX SAS</option>
                                <option value="CONSTRUCTORA CONCRETAR S.A.S.">CONSTRUCTORA CONCRETAR S.A.S.</option>
                                <option value="CONSTRUCTORA COSENZA">CONSTRUCTORA COSENZA</option>
                                <option value="CONSTRUCTORA COVIN S.A.">CONSTRUCTORA COVIN S.A.</option>
                                <option value="CONSTRUCTORA COLPATRIA S.A.">CONSTRUCTORA COLPATRIA S.A.</option>
                                <option value="CONSTRUCTORA DARCO SAS">CONSTRUCTORA DARCO SAS</option>
                                <option value="CONSTRUCTORA DEL TORO">CONSTRUCTORA DEL TORO</option>
                                <option value="CONSTRUCTORA EL CASTILLO">CONSTRUCTORA EL CASTILLO</option>
                                <option value="CONSTRUCTORA EL RUIZ">CONSTRUCTORA EL RUIZ</option>
                                <option value="CONSTRUCTORA EXPERTA SAS">CONSTRUCTORA EXPERTA SAS</option>
                                <option value="CONSTRUCTORA FCP AVENIDA COLOMBIA PEF II">CONSTRUCTORA FCP AVENIDA COLOMBIA PEF II</option>
                                <option value="CONSTRUCTORA GARPRO SAS">CONSTRUCTORA GARPRO SAS</option>
                                <option value="CONSTRUCTORA GARZON HOLGUIN GYH">CONSTRUCTORA GARZON HOLGUIN GYH</option>
                                <option value="CONSTRUCTORA HABITAMOS SAS">CONSTRUCTORA HABITAMOS SAS</option>
                                <option value="CONSTRUCTORA HABITAT DE LOS ANDES">CONSTRUCTORA HABITAT DE LOS ANDES</option>
                                <option value="CONSTRUCTORA INLASA S.A.S">CONSTRUCTORA INLASA S.A.S</option>
                                <option value="CONSTRUCTORA INMOBILAIRIA FRATELLI S.A.S.">CONSTRUCTORA INMOBILAIRIA FRATELLI S.A.S.</option>
                                <option value="CONSTRUCTORA JK SALCEDO SAS">CONSTRUCTORA JK SALCEDO SAS</option>
                                <option value="CONSTRUCTORA J Y P SAS">CONSTRUCTORA J Y P SAS</option>
                                <option value="CONSTRUCTORA JIMENEZ S.A.">CONSTRUCTORA JIMENEZ S.A.</option>
                                <option value="CONSTRUCTORA KOVOK S.A.S.">CONSTRUCTORA KOVOK S.A.S.</option>
                                <option value="CONSTRUCTORA LAS GALIAS S.A">CONSTRUCTORA LAS GALIAS S.A</option>
                                <option value="CONSTRUCTORA LARES">CONSTRUCTORA LARES</option>
                                <option value="CONSTRUCTORA MADECONS SA">CONSTRUCTORA MADECONS SA</option>
                                <option value="CONSTRUCTORA MAGATA CONSTRCUTORA SAS">CONSTRUCTORA MAGATA CONSTRCUTORA SAS</option>
                                <option value="CONSTRUCTORA MARQUIS S.A.">CONSTRUCTORA MARQUIS S.A.</option>
                                <option value="CONSTRUCTORA MATISSE S.A.S">CONSTRUCTORA MATISSE S.A.S</option>
                                <option value="CONSTRUCTORA MELENDEZ S.A.">CONSTRUCTORA MELENDEZ S.A.</option>
                                <option value="CONSTRUCTORA MMVR S.A.S">CONSTRUCTORA MMVR S.A.S</option>
                                <option value="CONSTRUCTORA MONSERRATE">CONSTRUCTORA MONSERRATE</option>
                                <option value="CONSTRUCTORA MURAGLIA S.A.">CONSTRUCTORA MURAGLIA S.A.</option>
                                <option value="CONSTRUCTORA OPEN">CONSTRUCTORA OPEN</option>
                                <option value="CONSTRUCTORA ORIGEN">CONSTRUCTORA ORIGEN</option>
                                <option value="CONSTRUCTORA PLINCO S.A.">CONSTRUCTORA PLINCO S.A.</option>
                                <option value="CONSTRUCTORA PRIMAR SA">CONSTRUCTORA PRIMAR SA</option>
                                <option value="CONSTRUCTORA PROYECTOS URBANOS SAS">CONSTRUCTORA PROYECTOS URBANOS SAS</option>
                                <option value="CONSTRUCTORA RIO AZUL">CONSTRUCTORA RIO AZUL</option>
                                <option value="CONSTRUCTORA RIVER PARK SAS">CONSTRUCTORA RIVER PARK SAS</option>
                                <option value="CONSTRUCTORA SOLANILLAS S.A">CONSTRUCTORA SOLANILLAS S.A</option>
                                <option value="CONSTRUCTORA SOLIDER S.A.S.">CONSTRUCTORA SOLIDER S.A.S.</option>
                                <option value="CONSTRUCTORA SUDAMERICANA">CONSTRUCTORA SUDAMERICANA</option>
                                <option value="CONSTRUCTORA TEYPRO">CONSTRUCTORA TEYPRO</option>
                                <option value="CONSTRUCTORA TORRES DE LA FRANCIA">CONSTRUCTORA TORRES DE LA FRANCIA</option>
                                <option value="CONSTRUCTORA YADEL S.A.S.">CONSTRUCTORA YADEL S.A.S.</option>
                                <option value="CONSTRUCTORA Y COMERCIALIZADORA CAMU">CONSTRUCTORA Y COMERCIALIZADORA CAMU</option>
                                <option value="CONSTRUCTORA Y COMERCIALIZADORA POPORO">CONSTRUCTORA Y COMERCIALIZADORA POPORO</option>
                                <option value="CONSTRUCTORA Y DESARROLLOS RENGIFO">CONSTRUCTORA Y DESARROLLOS RENGIFO</option>
                                <option value="CONVALLE CONSTRUCTORA S.A.S">CONVALLE CONSTRUCTORA S.A.S</option>
                                <option value="CONVEL SAS">CONVEL SAS</option>
                                <option value="COTESAB S.A.S">COTESAB S.A.S</option>
                                <option value="CREANDO ARQUITECTURA S.A.S.">CREANDO ARQUITECTURA S.A.S.</option>
                                <option value="CUBYCO CONSTRUCTORES S.A.">CUBYCO CONSTRUCTORES S.A.</option>
                                <option value="CVA CONTRUCTORA SAS">CVA CONTRUCTORA SAS</option>
                                <option value="CYMADE">CYMADE</option>
                                <option value="DEGA S.A.S.">DEGA S.A.S.</option>
                                <option value="DEEB ASOCIADOS S.A.S">DEEB ASOCIADOS S.A.S</option>
                                <option value="DESARROLLOS INMOBILIARIOS FUTURO SAS">DESARROLLOS INMOBILIARIOS FUTURO SAS</option>
                                <option value="DIPRECON SAS">DIPRECON SAS</option>
                                <option value="DISTEMACO S.A.S">DISTEMACO S.A.S</option>
                                <option value="DIVERSIFICAR SA">DIVERSIFICAR SA</option>
                                <option value="DOM REAL ESTATE">DOM REAL ESTATE</option>
                                <option value="DUQUE RENGIFO">DUQUE RENGIFO</option>
                                <option value="DYCO S.A.S.">DYCO S.A.S.</option>
                                <option value="ECINSA INGENIERIA S.A.S.">ECINSA INGENIERIA S.A.S.</option>
                                <option value="ECOSSUR S.A.S">ECOSSUR S.A.S</option>
                                <option value="EDC CONSTRUCCIONES S.A.S">EDC CONSTRUCCIONES S.A.S</option>
                                <option value="EDIFICADORA RIOVISTA S.A.S">EDIFICADORA RIOVISTA S.A.S</option>
                                <option value="EDIFICALIA S.A.S">EDIFICALIA S.A.S</option>
                                <option value="ENPROYECTOS S.A.S">ENPROYECTOS S.A.S</option>
                                <option value="EQUANIME SAS">EQUANIME SAS</option>
                                <option value="ESDIEZ CONSTRUCTORA S.A.S">ESDIEZ CONSTRUCTORA S.A.S</option>
                                <option value="ESFÉRICA S.A.S">ESFÉRICA S.A.S</option>
                                <option value="ESPACIO VITAL CONSTRUCTORES SA">ESPACIO VITAL CONSTRUCTORES SA</option>
                                <option value="ESTRUCTURAR INFRAESTRUCTURA SAS">ESTRUCTURAR INFRAESTRUCTURA SAS</option>
                                <option value="FAKTOR">FAKTOR</option>
                                <option value="FCR SAS">FCR SAS</option>
                                <option value="FENIX CONSTRUCCIONES S.A.">FENIX CONSTRUCCIONES S.A.</option>
                                <option value="FIC">FIC</option>
                                <option value="G4 INGENIEROS CIVILES S.A.S.">G4 INGENIEROS CIVILES S.A.S.</option>
                                <option value="GERENCIA MÁS PROYECTOS S.A.S">GERENCIA MÁS PROYECTOS S.A.S</option>
                                <option value="GESTION Y GERENCIA">GESTION Y GERENCIA</option>
                                <option value="GIDACOL SAS">GIDACOL SAS</option>
                                <option value="GRAMA">GRAMA</option>
                                <option value="GRAN MORADA CONSTRUCCIONES">GRAN MORADA CONSTRUCCIONES</option>
                                <option value="GRUPO ACCANTO">GRUPO ACCANTO</option>
                                <option value="GRUPO AR">GRUPO AR</option>
                                <option value="GRUPO BGR">GRUPO BGR</option>
                                <option value="GRUPO CONSTRUCTOR CALIBIO">GRUPO CONSTRUCTOR CALIBIO</option>
                                <option value="GRUPO EMPRESARIAL KINKU">GRUPO EMPRESARIAL KINKU</option>
                                <option value="GRUPO GERENCIAR">GRUPO GERENCIAR</option>
                                <option value="GRUPO GUASANDI (ANTES CDO)">GRUPO GUASANDI (ANTES CDO)</option>
                                <option value="GRUPO INMOBILIARIO PAISAJE URBANO SAS">GRUPO INMOBILIARIO PAISAJE URBANO SAS</option>
                                <option value="GRUPO INMOBILIARIO Y CONSTRUCTOR VALOR SA">GRUPO INMOBILIARIO Y CONSTRUCTOR VALOR SA</option>
                                <option value="GRUPO LORCA">GRUPO LORCA</option>
                                <option value="GRUPO MOYUA">GRUPO MOYUA</option>
                                <option value="GRUPO OIKOS S.A.">GRUPO OIKOS S.A.</option>
                                <option value="GRUPO QUARTO">GRUPO QUARTO</option>
                                <option value="GRUPO SOLERIUM">GRUPO SOLERIUM</option>
                                <option value="GRUPO VS LIMITADA">GRUPO VS LIMITADA</option>
                                <option value="HAYUELOS DE COLOMBIA S.A.S">HAYUELOS DE COLOMBIA S.A.S</option>
                                <option value="HITOS URBANOS S.A.S">HITOS URBANOS S.A.S</option>
                                <option value="IARCO S.A.">IARCO S.A.</option>
                                <option value="ICONO URBANO S.A.">ICONO URBANO S.A.</option>
                                <option value="IMOVAL">IMOVAL</option>
                                <option value="INACAR S.A">INACAR S.A</option>
                                <option value="INDIVA DESIGN S.A.S.">INDIVA DESIGN S.A.S.</option>
                                <option value="INGEARCO Y GRUPO CIUDADELA">INGEARCO Y GRUPO CIUDADELA</option>
                                <option value="INGENAL S.A.">INGENAL S.A.</option>
                                <option value="INGENIA CONSTRUCCIONES S.A.S">INGENIA CONSTRUCCIONES S.A.S</option>
                                <option value="INGENIERIA INMOBILIARIA S.A.">INGENIERIA INMOBILIARIA S.A.</option>
                                <option value="INGENIERIA Y HERRAMIENTAS S.A.S">INGENIERIA Y HERRAMIENTAS S.A.S</option>
                                <option value="INGENIERIA Y VIVIENDA SAS">INGENIERIA Y VIVIENDA SAS</option>
                                <option value="INGENOVA ING">INGENOVA ING</option>
                                <option value="INMOBILIARIA DALI">INMOBILIARIA DALI</option>
                                <option value="INMOBILIARIA PROACTIVA SA">INMOBILIARIA PROACTIVA SA</option>
                                <option value="INMOVEL">INMOVEL</option>
                                <option value="INSERCO">INSERCO</option>
                                <option value="INTEGRA GERENCIA Y CONSTRUCCIONES SAS">INTEGRA GERENCIA Y CONSTRUCCIONES SAS</option>
                                <option value="INTORNO">INTORNO</option>
                                <option value="INUBERCO">INUBERCO</option>
                                <option value="INVERSIONES HYH LTDA">INVERSIONES HYH LTDA</option>
                                <option value="INVERSIONES HARI SAS">INVERSIONES HARI SAS</option>
                                <option value="INVERSIONES LA CAROLINA S.A.S.">INVERSIONES LA CAROLINA S.A.S.</option>
                                <option value="INVERSIONES LA PENINSULA LTDA">INVERSIONES LA PENINSULA LTDA</option>
                                <option value="INVERSIONES MAGLA">INVERSIONES MAGLA</option>
                                <option value="INVERSIONES NT3 S.A.S">INVERSIONES NT3 S.A.S</option>
                                <option value="INVERSIONES OYAGA 1323 S.A.S">INVERSIONES OYAGA 1323 S.A.S</option>
                                <option value="INVERSIONES POLARIS">INVERSIONES POLARIS</option>
                                <option value="INVERSIONES PROMEXPORT S.A.S.">INVERSIONES PROMEXPORT S.A.S.</option>
                                <option value="INVERSIONES RODAS - INVERSIONES MAGLA">INVERSIONES RODAS - INVERSIONES MAGLA</option>
                                <option value="INVERSIONES TERRA S.A.">INVERSIONES TERRA S.A.</option>
                                <option value="INVERSIONES TORRELAVEGA SAS">INVERSIONES TORRELAVEGA SAS</option>
                                <option value="INVERSIONES VALLE DEL PACIFICO INVERFIN">INVERSIONES VALLE DEL PACIFICO INVERFIN</option>
                                <option value="IPC INMOBILIARIO SAS">IPC INMOBILIARIO SAS</option>
                                <option value="JAER GERENCIA DE PROYECTOS">JAER GERENCIA DE PROYECTOS</option>
                                <option value="JARAMILLO ARQUITECTOS">JARAMILLO ARQUITECTOS</option>
                                <option value="JARAMILLO MORA">JARAMILLO MORA</option>
                                <option value="J. FELIPE ARDILA">J. FELIPE ARDILA</option>
                                <option value="J. PACHON SOCIEDAD POR ACCIONES">J. PACHON SOCIEDAD POR ACCIONES</option>
                                <option value="JS INGENERIA Y CONSTRUCCIONES SAS">JS INGENERIA Y CONSTRUCCIONES SAS</option>
                                <option value="JULIO CESAR GUERRERO">JULIO CESAR GUERRERO</option>
                                <option value="KREAR CONSTRUCTORES S.A.S">KREAR CONSTRUCTORES S.A.S</option>
                                <option value="KROMO">KROMO</option>
                                <option value="KUMAN SAS">KUMAN SAS</option>
                                <option value="LA CONSTRUCTORA">LA CONSTRUCTORA</option>
                                <option value="LEGF CONSTRUCTORA SAS">LEGF CONSTRUCTORA SAS</option>
                                <option value="LEON AGUILERA S.A.">LEON AGUILERA S.A.</option>
                                <option value="LG INVERSIONES - GRUPO DESARROLLADOR SABANA">LG INVERSIONES - GRUPO DESARROLLADOR SABANA</option>
                                <option value="LONDOÑO GOMEZ">LONDOÑO GOMEZ</option>
                                <option value="LOPEZ CUBILLOS CONSTRUCCIONES SAS">LOPEZ CUBILLOS CONSTRUCCIONES SAS</option>
                                <option value="L&L CONSTRUCCIONES CON DISEÑO SAS">L&L CONSTRUCCIONES CON DISEÑO SAS</option>
                                <option value="LUQUE OSPINA">LUQUE OSPINA</option>
                                <option value="M+D CONSTRUCTORA">M+D CONSTRUCTORA</option>
                                <option value="MAYA Y ASOCIADOS SAS">MAYA Y ASOCIADOS SAS</option>
                                <option value="MANDAL CONSTRUCCIONES S.A.S.">MANDAL CONSTRUCCIONES S.A.S.</option>
                                <option value="MARVAL SA">MARVAL SA</option>
                                <option value="MEJIA VILLEGAS CONSTRUCTORES S.A.">MEJIA VILLEGAS CONSTRUCTORES S.A.</option>
                                <option value="MENSULA S.A.">MENSULA S.A.</option>
                                <option value="MEVIC">MEVIC</option>
                                <option value="MG CONSTRUCCIONES Y EQUIPOS S.A.S.">MG CONSTRUCCIONES Y EQUIPOS S.A.S.</option>
                                <option value="MGJ">MGJ</option>
                                <option value="MIPKO CONSTRUCTORES S.A.S.">MIPKO CONSTRUCTORES S.A.S.</option>
                                <option value="MOSEL S.A.S.">MOSEL S.A.S.</option>
                                <option value="MOVEC SAS">MOVEC SAS</option>
                                <option value="MULTICONSTRUCCIONES JP">MULTICONSTRUCCIONES JP</option>
                                <option value="MUISCA CONSTRUCCIONES SAS">MUISCA CONSTRUCCIONES SAS</option>
                                <option value="NATURA SAS">NATURA SAS</option>
                                <option value="NUCLEO CONSTRUCTORA S.A.S.">NUCLEO CONSTRUCTORA S.A.S.</option>
                                <option value="NT GROUP SAS">NT GROUP SAS</option>
                                <option value="NUEVO HORIZONTE">NUEVO HORIZONTE</option>
                                <option value="OBRAS CIVILES Y ACABADOS">OBRAS CIVILES Y ACABADOS</option>
                                <option value="OBRAS Y MAQUINAS S.A.S">OBRAS Y MAQUINAS S.A.S</option>
                                <option value="ODICCO LTDA">ODICCO LTDA</option>
                                <option value="ONCE CONSTRUCTORA S.A.S.">ONCE CONSTRUCTORA S.A.S.</option>
                                <option value="OPA CONSTRUCTORES S.A.">OPA CONSTRUCTORES S.A.</option>
                                <option value="OPTIMA S.A.">OPTIMA S.A.</option>
                                <option value="OPTIMO INVERSIONES S.A.S.">OPTIMO INVERSIONES S.A.S.</option>
                                <option value="ORBE SAS CONSTRUCCIONES">ORBE SAS CONSTRUCCIONES</option>
                                <option value="ORGANIZACION CENTENARIO">ORGANIZACION CENTENARIO</option>
                                <option value="ORGANIZACION EDYFICA SA">ORGANIZACION EDYFICA SA</option>
                                <option value="ORMECO">ORMECO</option>
                                <option value="PACTAR DESARROLLADOR INMOBILIARIO S.A.S.">PACTAR DESARROLLADOR INMOBILIARIO S.A.S.</option>
                                <option value="PADILLA MORENO">PADILLA MORENO</option>
                                <option value="PALACIO OFICINA DE CONSTRUCCIONES S.A">PALACIO OFICINA DE CONSTRUCCIONES S.A</option>
                                <option value="PCA SOLUCIONES ARQUITECTONICAS SAS">PCA SOLUCIONES ARQUITECTONICAS SAS</option>
                                <option value="PEDRO GOMEZ Y CIA">PEDRO GOMEZ Y CIA</option>
                                <option value="PETRUS LURA S.A.S">PETRUS LURA S.A.S</option>
                                <option value="PLANEACIÓN Y EDIFICACIÓN S.A.S.">PLANEACIÓN Y EDIFICACIÓN S.A.S.</option>
                                <option value="PLATAFORMA CONSTRUCTORES SAS">PLATAFORMA CONSTRUCTORES SAS</option>
                                <option value="POTENCO S.A.S">POTENCO S.A.S</option>
                                <option value="PPM INVERSIONES S.A.">PPM INVERSIONES S.A.</option>
                                <option value="PROACTIV SAS">PROACTIV SAS</option>
                                <option value="PRODESA">PRODESA</option>
                                <option value="PROGRESSIVE HORIZON">PROGRESSIVE HORIZON</option>
                                <option value="PROHOGAR">PROHOGAR</option>
                                <option value="PROIN">PROIN</option>
                                <option value="PROINSA SAS">PROINSA SAS</option>
                                <option value="PROKSOL">PROKSOL</option>
                                <option value="PROMOTORA 775 S.A.S. Y PROMOTORA MAGNO LOFT">PROMOTORA 775 S.A.S. Y PROMOTORA MAGNO LOFT</option>
                                <option value="PROMOTORA AIKI">PROMOTORA AIKI</option>
                                <option value="PROMOTORA ALTO DE PALMAS SAS">PROMOTORA ALTO DE PALMAS SAS</option>
                                <option value="PROMOTORA APOTEMA SAS">PROMOTORA APOTEMA SAS</option>
                                <option value="PROMOTORA AZORE S.A.S">PROMOTORA AZORE S.A.S</option>
                                <option value="PROMOTORA CAMPESTRE">PROMOTORA CAMPESTRE</option>
                                <option value="PROMOTORA CIBELS S.A.S">PROMOTORA CIBELS S.A.S</option>
                                <option value="PROMOTORA FORESTA">PROMOTORA FORESTA</option>
                                <option value="PROMOTORA G 15 S.A.S">PROMOTORA G 15 S.A.S</option>
                                <option value="PROMOTORA MINT">PROMOTORA MINT</option>
                                <option value="PROMOTORA NURIA">PROMOTORA NURIA</option>
                                <option value="PROMOTORA NIVEL SAS">PROMOTORA NIVEL SAS</option>
                                <option value="PROMOTORA SAN MIGUEL S.A.S">PROMOTORA SAN MIGUEL S.A.S</option>
                                <option value="PROMOTORA SEAPORT S.A.S">PROMOTORA SEAPORT S.A.S</option>
                                <option value="PROMOTORA TORICES DEL MAR S.A.S.">PROMOTORA TORICES DEL MAR S.A.S.</option>
                                <option value="PROMOTORA VIVENDI SAS">PROMOTORA VIVENDI SAS</option>
                                <option value="PROURBE SA">PROURBE SA</option>
                                <option value="PROYECTAMOS Y EDIFICAMOS">PROYECTAMOS Y EDIFICAMOS</option>
                                <option value="PROYECTO ESTRATEGIA LTDA">PROYECTO ESTRATEGIA LTDA</option>
                                <option value="PROYECTOS DE INGENIERÍA AVANZADA PRINZA">PROYECTOS DE INGENIERÍA AVANZADA PRINZA</option>
                                <option value="PROYECTOS E INVERSIONES MPL SAS">PROYECTOS E INVERSIONES MPL SAS</option>
                                <option value="PROYECTOS GIRARDOT Y ALREDEDORES">PROYECTOS GIRARDOT Y ALREDEDORES</option>
                                <option value="PROYECTOS URBANOS 3L S.A.S.">PROYECTOS URBANOS 3L S.A.S.</option>
                                <option value="PROYECTOS URBANOS DE COLOMBIA S.A.S.">PROYECTOS URBANOS DE COLOMBIA S.A.S.</option>
                                <option value="PRANHA S.A">PRANHA S.A</option>
                                <option value="Q-BICA">Q-BICA</option>
                                <option value="QUINTERO ARBELAEZ SAS">QUINTERO ARBELAEZ SAS</option>
                                <option value="R.A.D.F INVERSIONES S.A.S.">R.A.D.F INVERSIONES S.A.S.</option>
                                <option value="RFP CONSTRUCTORES S.A.S.">RFP CONSTRUCTORES S.A.S.</option>
                                <option value="RESIDERE S.A.S">RESIDERE S.A.S</option>
                                <option value="ROBLE CONSTRUCCIONES SAS">ROBLE CONSTRUCCIONES SAS</option>
                                <option value="RODRIGUEZ BRIÑEZ S.A.S.">RODRIGUEZ BRIÑEZ S.A.S.</option>
                                <option value="RUIZ AREVALO CONSTRUCTORA S.A.">RUIZ AREVALO CONSTRUCTORA S.A.</option>
                                <option value="SAHA CONSTRUCCIONES">SAHA CONSTRUCCIONES</option>
                                <option value="SAVE INVERSIONES Y PROYECTOS S.A.S">SAVE INVERSIONES Y PROYECTOS S.A.S</option>
                                <option value="SEIKA S.A.S.">SEIKA S.A.S.</option>
                                <option value="SIMBRA">SIMBRA</option>
                                <option value="SINTAGMA S.A.S">SINTAGMA S.A.S</option>
                                <option value="SOHNOS SAS">SOHNOS SAS</option>
                                <option value="SOLARI INVERSIONES Y DESARROLLOS INMOBILIARIOS SAS">SOLARI INVERSIONES Y DESARROLLOS INMOBILIARIOS SAS</option>
                                <option value="SOLUCIONES CIVILES">SOLUCIONES CIVILES</option>
                                <option value="SOLUCIONES CONSTRUCTIVAS S.A.S">SOLUCIONES CONSTRUCTIVAS S.A.S</option>
                                <option value="SOLUCIONES DE VIVIENDA SV S.A.S">SOLUCIONES DE VIVIENDA SV S.A.S</option>
                                <option value="SOLUCIONES SIVIS S.A.S">SOLUCIONES SIVIS S.A.S</option>
                                <option value="SOPROTEC SAS">SOPROTEC SAS</option>
                                <option value="STOGON CONSTRUCTORA S.A.S">STOGON CONSTRUCTORA S.A.S</option>
                                <option value="SUMAS CONSTRUCCIONES SAS">SUMAS CONSTRUCCIONES SAS</option>
                                <option value="SUPERHAVIT-AT">SUPERHAVIT-AT</option>
                                <option value="TEKTON ARQUITECTURA EI NGENIERIA SAS">TEKTON ARQUITECTURA EI NGENIERIA SAS</option>
                                <option value="TELVAL S.A.S.">TELVAL S.A.S.</option>
                                <option value="TERRAPIN SAS">TERRAPIN SAS</option>
                                <option value="TIERRA GRATA & CO">TIERRA GRATA & CO</option>
                                <option value="TOUS CONSTRUCTORA">TOUS CONSTRUCTORA</option>
                                <option value="TRAZOS URBANOS S.A.S.">TRAZOS URBANOS S.A.S.</option>
                                <option value="TRAMETAL">TRAMETAL</option>
                                <option value="TRAMONTANA CONSTRUCTORA SAS">TRAMONTANA CONSTRUCTORA SAS</option>
                                <option value="TRIPLE AAA S.A.S">TRIPLE AAA S.A.S</option>
                                <option value="TRIADA S.A.S.">TRIADA S.A.S.</option>
                                <option value="TRUJILLO GUTIERREZ">TRUJILLO GUTIERREZ</option>
                                <option value="TU CASA PROYECTOS S.A.S.">TU CASA PROYECTOS S.A.S.</option>
                                <option value="UMBRAL">UMBRAL</option>
                                <option value="UNION TEMPORAL SANTAMARIA">UNION TEMPORAL SANTAMARIA</option>
                                <option value="UNOSESENTAIUNO S.A.S.">UNOSESENTAIUNO S.A.S.</option>
                                <option value="UNO SEIS SAS">UNO SEIS SAS</option>
                                <option value="URAKI CONSTRUCTORA">URAKI CONSTRUCTORA</option>
                                <option value="URBAMARES">URBAMARES</option>
                                <option value="URBANIZAR PEREIRA SAS">URBANIZAR PEREIRA SAS</option>
                                <option value="VAVILCO">VAVILCO</option>
                                <option value="VECTOR CONSTRUCCIONES S.A.S.">VECTOR CONSTRUCCIONES S.A.S.</option>
                                <option value="VERSION URBANA">VERSION URBANA</option>
                                <option value="VERTICE">VERTICE</option>
                                <option value="VERTICES URBANOS SAS">VERTICES URBANOS SAS</option>
                                <option value="VERTIZE">VERTIZE</option>
                                <option value="VICTORIA ADMINISTRADORES">VICTORIA ADMINISTRADORES</option>
                                <option value="VIVAL ARQUITECTOS">VIVAL ARQUITECTOS</option>
                                <option value="VIVIENDAS Y PROYECTOS S.A.S">VIVIENDAS Y PROYECTOS S.A.S</option>
                            </datalist>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3" id="subgrupos-container">
                        <label class="form-label">Subgrupos y Porcentajes</label>
                        <div class="input-group mb-2">
                            <input list="grupo_de_riesgo-list" class="form-control subgrupo-input" name="subgrupos[]" placeholder="Subgrupo 1">
                            <input type="number" class="form-control porcentaje-input" name="porcentajes[]" placeholder="%" step="0.01" min="0" max="100" style="max-width: 100px;">
                            <button type="button" class="btn btn-success btn-add-subgrupo">+</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">NIT Grupo de Riesgo</label>
                            <input type="number" class="form-control" name="nit_grupo_riesgo" required>
                        </div>
                    </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">Nombre Proyecto</label>
                            <input type="text" class="form-control" name="nombre_proyecto" required>
                        </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tipo de Proyecto</label>
                            <select class="form-select" id="tipo_proyecto" name="tipo_proyecto">
                                <option value="">Seleccione un tipo</option>
                                <option value="VIS APTOS">VIS APTOS</option>
                                <option value="VIS CASAS">VIS CASAS</option>
                                <option value="NO VIS APTOS">NO VIS APTOS</option>
                                <option value="NO VIS CASAS">NO VIS CASAS</option>
                                <option value="DIF DE VVDA BODEGAS">DIF DE VVDA BODEGAS</option>
                                <option value="DIF DE VVDA LOCALES">DIF DE VVDA LOCALES</option>
                                <option value="DIF DE VVDA CONSULTORIOS">DIF DE VVDA CONSULTORIOS</option>
                                <option value="DIF DE VVDA OFICINAS">DIF DE VVDA OFICINAS</option>
                                <option value="DIF DE VVDA HOTELES">DIF DE VVDA HOTELES</option>
                                <option value="DIF DE VVDA OTROS">DIF DE VVDA OTROS</option>
                                <option value="LOTES Y PARCELACIONES">LOTES Y PARCELACIONES</option>
                            </select>
                        </div>
                        <div class="container mt-5">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Departamento</label>
                                    <select class="form-select" id="departamento" name="departamento">
                                        <option value="">Cargando departamentos...</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Municipio</label>
                                    <select class="form-select" id="municipio" name="municipio" disabled>
                                        <option value="">Primero seleccione un departamento</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">NIT Titular</label>
                            <input type="number" class="form-control" name="nit_titular">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Titular Crédito</label>
                            <input type="text" class="form-control" name="titular_credito">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Gerente</label>
                            <select class="form-select" name="gerente">
                                <option value="">Seleccione un Gerente...</option>
                                <option value="ADELA YANNETH MEDINA">ADELA YANNETH MEDINA</option>
                                <option value="ALBERTO ENRIQUE PINZON">ALBERTO ENRIQUE PINZON</option>
                                <option value="ALEJANDRA GALEANO CASTAÑEDA">ALEJANDRA GALEANO CASTAÑEDA</option>
                                <option value="ALEJANDRA PATRICIA ORTIZ GUTIERREZ">ALEJANDRA PATRICIA ORTIZ GUTIERREZ</option>
                                <option value="ANDREA DEL PILAR HERNANDEZ SALAZAR">ANDREA DEL PILAR HERNANDEZ SALAZAR</option>
                                <option value="ANDREA PAOLA CASTILLO MONGUI">ANDREA PAOLA CASTILLO MONGUI</option>
                                <option value="ANDRES FELIPE BELTRAN RUEDA">ANDRES FELIPE BELTRAN RUEDA</option>
                                <option value="ANGIE ALEXANDRA JEREZ QUIROGA">ANGIE ALEXANDRA JEREZ QUIROGA</option>
                                <option value="ANGIE BOLENA LOPEZ SOTO">ANGIE BOLENA LOPEZ SOTO</option>
                                <option value="ARGENIS DEL ROCIO GUTIERREZ">ARGENIS DEL ROCIO GUTIERREZ</option>
                                <option value="ASTRID BIBIANA HERRERA URIBE">ASTRID BIBIANA HERRERA URIBE</option>
                                <option value="ASTRID ELENA PEÑA MARRIAGA">ASTRID ELENA PEÑA MARRIAGA</option>
                                <option value="ASTRID SOFIA CORREA SEPULVEDA">ASTRID SOFIA CORREA SEPULVEDA</option>
                                <option value="BLEIDY YOHANA TORRADO SANGUINO CHONA">BLEIDY YOHANA TORRADO SANGUINO CHONA</option>
                                <option value="CARLOS ARTURO LONDOÑO MONTALVO">CARLOS ARTURO LONDOÑO MONTALVO</option>
                                <option value="CARLOS AUGUSTO ZORRO CALDERON">CARLOS AUGUSTO ZORRO CALDERON</option>
                                <option value="CARLOS FERNANDO DAZA GUERRERO">CARLOS FERNANDO DAZA GUERRERO</option>
                                <option value="CATALINA GUTIERREZ VELILLA">CATALINA GUTIERREZ VELILLA</option>
                                <option value="CATHERINE MATIZ ESPINOSA">CATHERINE MATIZ ESPINOSA</option>
                                <option value="CINDY ESTEPHANIA GIGLIOLI GIRALDO">CINDY ESTEPHANIA GIGLIOLI GIRALDO</option>
                                <option value="DANIEL MAURICIO HERNANDEZ PAREDES">DANIEL MAURICIO HERNANDEZ PAREDES</option>
                                <option value="DANIELA FIGUEROA LONDOÑO">DANIELA FIGUEROA LONDOÑO</option>
                                <option value="DAVID SEBASTIAN CASTAÑO GIRALDO">DAVID SEBASTIAN CASTAÑO GIRALDO</option>
                                <option value="DIANA MILENA CRUZ ORTEGA">DIANA MILENA CRUZ ORTEGA</option>
                                <option value="DIANA MILENA GIL ARIAS">DIANA MILENA GIL ARIAS</option>
                                <option value="EDGAR FERNEY ÑUSTES ALMANZA">EDGAR FERNEY ÑUSTES ALMANZA</option>
                                <option value="EDIT YOHANA CARMONA FORONDA">EDIT YOHANA CARMONA FORONDA</option>
                                <option value="ELIANA SOFIA CORENA GONZALEZ">ELIANA SOFIA CORENA GONZALEZ</option>
                                <option value="ELIZABETH MEDINA QUINTERO">ELIZABETH MEDINA QUINTERO</option>
                                <option value="FABIAN ANDRES MEJIA PULGARIN">FABIAN ANDRES MEJIA PULGARIN</option>
                                <option value="FERNANDO ROBAYO LOPEZ">FERNANDO ROBAYO LOPEZ</option>
                                <option value="GLORIA ANGELICA LUNA NIÑO">GLORIA ANGELICA LUNA NIÑO</option>
                                <option value="GLORIA ELIZABETH LASSO MORENO">GLORIA ELIZABETH LASSO MORENO</option>
                                <option value="HERMES RICARDO RINCON PONCE">HERMES RICARDO RINCON PONCE</option>
                                <option value="INGRID EDITH FRANCO SOLER">INGRID EDITH FRANCO SOLER</option>
                                <option value="INGRID JOHANNA ARISTIZABAL">INGRID JOHANNA ARISTIZABAL</option>
                                <option value="IRMA CONSTANZA PAEZ DIAZ">IRMA CONSTANZA PAEZ DIAZ</option>
                                <option value="ISABEL CRISTINA CADAVID OROZCO">ISABEL CRISTINA CADAVID OROZCO</option>
                                <option value="JACKELINE VARON MARTINEZ">JACKELINE VARON MARTINEZ</option>
                                <option value="JADER ANTONIO VELASQUEZ AYALA">JADER ANTONIO VELASQUEZ AYALA</option>
                                <option value="JAIR FELIPE ZORRILLA GUEVARA">JAIR FELIPE ZORRILLA GUEVARA</option>
                                <option value="JEANNE CEBALLOS VILLA">JEANNE CEBALLOS VILLA</option>
                                <option value="JEIMMY STEPHANY CORREA RAMIREZ">JEIMMY STEPHANY CORREA RAMIREZ</option>
                                <option value="JOSE ERNESTO RIVERA RUEDA">JOSE ERNESTO RIVERA RUEDA</option>
                                <option value="JOYCE SMITH CRUZ RODRIGUEZ">JOYCE SMITH CRUZ RODRIGUEZ</option>
                                <option value="JUAN CAMILO NOREÑA OSORIO">JUAN CAMILO NOREÑA OSORIO</option>
                                <option value="JUAN FERNANDO OROZCO MONTOYA">JUAN FERNANDO OROZCO MONTOYA</option>
                                <option value="JUAN FERNANDO PEREZ VELASQUEZ">JUAN FERNANDO PEREZ VELASQUEZ</option>
                                <option value="JULIANA PALOMARES ARANGO">JULIANA PALOMARES ARANGO</option>
                                <option value="KAREN LILIANA WILCHES DE ANGELIS">KAREN LILIANA WILCHES DE ANGELIS</option>
                                <option value="KAROL ANGELICA HERRERA RUIZ">KAROL ANGELICA HERRERA RUIZ</option>
                                <option value="KELLY JOHANNA ROJAS TRUJILLO">KELLY JOHANNA ROJAS TRUJILLO</option>
                                <option value="LAURA LUCIA FLOREZ YANEZ">LAURA LUCIA FLOREZ YANEZ</option>
                                <option value="LAURA MARIA CORREA CALDERON">LAURA MARIA CORREA CALDERON</option>
                                <option value="LENIN ANIBAL BUSTOS MENDEZ">LENIN ANIBAL BUSTOS MENDEZ</option>
                                <option value="LILIA ROSA MOLINA LLERENA">LILIA ROSA MOLINA LLERENA</option>
                                <option value="LINA MARIA CASTAÑO URIBE">LINA MARIA CASTAÑO URIBE</option>
                                <option value="LINA MARIA TORO PALACIO">LINA MARIA TORO PALACIO</option>
                                <option value="LORENA DEL MAR SANDOVAL POLANCO">LORENA DEL MAR SANDOVAL POLANCO</option>
                                <option value="LUISA FERNANDA CASTAÑO BENITEZ">LUISA FERNANDA CASTAÑO BENITEZ</option>
                                <option value="LUZ ADRIANA GRAJALES ALVAREZ">LUZ ADRIANA GRAJALES ALVAREZ</option>
                                <option value="LUZ MERY QUINTERO CARDONA">LUZ MERY QUINTERO CARDONA</option>
                                <option value="MARGARITA MARIA HORMAZA GALLEGO">MARGARITA MARIA HORMAZA GALLEGO</option>
                                <option value="MARIA FERNANDA REYES MORENO">MARIA FERNANDA REYES MORENO</option>
                                <option value="MARIA FRANCY SAAVEDRA PINZON">MARIA FRANCY SAAVEDRA PINZON</option>
                                <option value="MARIA PAULINA SARMIENTO ECHEVERRI">MARIA PAULINA SARMIENTO ECHEVERRI</option>
                                <option value="MILTON YESID CASTILLO PARRA">MILTON YESID CASTILLO PARRA</option>
                                <option value="MONICA DEL CARMEN TAFUR ARIZA">MONICA DEL CARMEN TAFUR ARIZA</option>
                                <option value="NANCY EYDY PINEDA CIFUENTES">NANCY EYDY PINEDA CIFUENTES</option>
                                <option value="NANCY MIRELLA ROJAS ORTIZ">NANCY MIRELLA ROJAS ORTIZ</option>
                                <option value="NELLY KARINA ARCHILA ARENAS">NELLY KARINA ARCHILA ARENAS</option>
                                <option value="NIDYA ESPERANZA BURGOS GAYON">NIDYA ESPERANZA BURGOS GAYON</option>
                                <option value="NILSON PEÑA BOTELLO">NILSON PEÑA BOTELLO</option>
                                <option value="NORMA CONSTANZA GIL GARCIA">NORMA CONSTANZA GIL GARCIA</option>
                                <option value="OLGA CECILIA GARCIA MUNERA">OLGA CECILIA GARCIA MUNERA</option>
                                <option value="PAOLA ANDREA AMAYA MORENO">PAOLA ANDREA AMAYA MORENO</option>
                                <option value="PAOLA ANDREA GALINDO LOZA">PAOLA ANDREA GALINDO LOZA</option>
                                <option value="PAOLA ANDREA LOZADA GARCES">PAOLA ANDREA LOZADA GARCES</option>
                                <option value="PATRICIA CIPACON AGUILLON">PATRICIA CIPACON AGUILLON</option>
                                <option value="PAULA ANDREA GAVIRIA BASTIDAS">PAULA ANDREA GAVIRIA BASTIDAS</option>
                                <option value="RAUL IGNACIO CASALLAS MELO">RAUL IGNACIO CASALLAS MELO</option>
                                <option value="REINALDO SILVA">REINALDO SILVA</option>
                                <option value="RUBEN DARIO URIBE MEJIA">RUBEN DARIO URIBE MEJIA</option>
                                <option value="SANDRA MILENA MORENO ZAPATA">SANDRA MILENA MORENO ZAPATA</option>
                                <option value="SANDRA PATRICIA LINARES MORENO">SANDRA PATRICIA LINARES MORENO</option>
                                <option value="SANDRA PATRICIA ROMAN CASTAÑEDA">SANDRA PATRICIA ROMAN CASTAÑEDA</option>
                                <option value="SANTIAGO ESCOBAR DELGADO">SANTIAGO ESCOBAR DELGADO</option>
                                <option value="SEBASTIAN ARBELAEZ AGUDELO">SEBASTIAN ARBELAEZ AGUDELO</option>
                                <option value="SEBASTIAN HURTADO ARBELAEZ">SEBASTIAN HURTADO ARBELAEZ</option>
                                <option value="SILVIA JANETH MORA MONROY">SILVIA JANETH MORA MONROY</option>
                                <option value="TATIANA COSTA OSSA">TATIANA COSTA OSSA</option>
                                <option value="VACANTE">VACANTE</option>
                                <option value="VICTOR FERNANDO REDONDO LANCHEROS">VICTOR FERNANDO REDONDO LANCHEROS</option>
                                <option value="VICTOR HUGO CORREA MONTOYA">VICTOR HUGO CORREA MONTOYA</option>
                                <option value="VICTOR MANUEL SALAZAR ARENAS">VICTOR MANUEL SALAZAR ARENAS</option>
                                <option value="WILMAR DARIO PRADA PARRA">WILMAR DARIO PRADA PARRA</option>
                                <option value="WILSON ARLEY CARO CASTAÑO">WILSON ARLEY CARO CASTAÑO</option>
                                <option value="YAMILE DEL ROCIO GARCIA MELO">YAMILE DEL ROCIO GARCIA MELO</option>
                                <option value="YERLY MARIA GUTIERREZ MUÑOZ">YERLY MARIA GUTIERREZ MUÑOZ</option>
                                <option value="YOLANDA BELLO RODRIGUEZ">YOLANDA BELLO RODRIGUEZ</option>
                                <option value="YOLIMA PACHON PACHON">YOLIMA PACHON PACHON</option>
                                <option value="YUDI ASTRID MARTINEZ JIMENEZ">YUDI ASTRID MARTINEZ JIMENEZ</option>
                                <option value="ZEILA HORTENCIA TAPIAS MURILLO">ZEILA HORTENCIA TAPIAS MURILLO</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Arquitecto</label>
                            <select class="form-select" name="arquitecto">
                                <option value="">Seleccione Arquitecto</option>
                                <option value="ANA MARIA MONTOYA OROZCO">ANA MARIA MONTOYA OROZCO</option>
                                <option value="JUAN CARLOS VASQUEZ CORREA">JUAN CARLOS VASQUEZ CORREA</option>
                                <option value="MANUELA ESCOBAR GAVIRIA">MANUELA ESCOBAR GAVIRIA</option>
                                <option value="MARIA DANIELA GOMEZ MURCIA">MARIA DANIELA GOMEZ MURCIA</option>
                                <option value="MAURICIO ANDRES LOPEZ PINEDA">MAURICIO ANDRES LOPEZ PINEDA</option>
                                <option value="NATALIA RODRIGUEZ CASTILLO">NATALIA RODRIGUEZ CASTILLO</option>
                                <option value="PEDRO ANDRES DELGADILLO ROBAYO">PEDRO ANDRES DELGADILLO ROBAYO</option>
                                <option value="RICARDO GUIZADO ALVAREZ">RICARDO GUIZADO ALVAREZ</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Auxiliar</label>
                            <select class="form-select" name="auxiliar">
                                <option value="">Seleccione Auxiliar</option>
                                <option value="ANA LUCIA ARANGO">ANA LUCIA ARANGO</option>
                                <option value="DANIEL CICERO">DANIEL CICERO</option>
                                <option value="YENIFER PEREZ">YENIFER PEREZ</option>
                                <option value="CARLOS DAVID ECHEVERRI">CARLOS DAVID ECHEVERRI</option>
                                <option value="LILIANA DUARTE">LILIANA DUARTE</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Perito</label>
                            <select class="form-select" name="perito">
                                <option value="">Seleccione Perito</option>
                                <option value="ÁLVARO GARCIA RONDEROS">ÁLVARO GARCIA RONDEROS</option>
                                <option value="ANDRES HIDALGO">ANDRES HIDALGO</option>
                                <option value="ARMANDO JOSE RODRIGUEZ PAVA">ARMANDO JOSE RODRIGUEZ PAVA</option>
                                <option value="BEATRIZ BARRIOS ARRAZOLA">BEATRIZ BARRIOS ARRAZOLA</option>
                                <option value="BEATRIZ SAN CLEMENTE">BEATRIZ SAN CLEMENTE</option>
                                <option value="CARLOS EDUARDO RODRIGUEZ">CARLOS EDUARDO RODRIGUEZ</option>
                                <option value="CARMEN CECILIA REYES">CARMEN CECILIA REYES</option>
                                <option value="DARIO GONZALEZ VALENCIA">DARIO GONZALEZ VALENCIA</option>
                                <option value="DIEGO ECHEVERRI">DIEGO ECHEVERRI</option>
                                <option value="EDGAR GAMBOA">EDGAR GAMBOA</option>
                                <option value="ENRIQUE TATIS PEREZ">ENRIQUE TATIS PEREZ</option>
                                <option value="GABRIEL MUÑOZ">GABRIEL MUÑOZ</option>
                                <option value="GERARDO RIVERA">GERARDO RIVERA</option>
                                <option value="GLORIA ELENA DUQUE">GLORIA ELENA DUQUE</option>
                                <option value="GUIDO JACOME">GUIDO JACOME</option>
                                <option value="HÉCTOR ARTURO CASTILLO MEDINA">HÉCTOR ARTURO CASTILLO MEDINA</option>
                                <option value="HERNANDO MEJIA DUQUE">HERNANDO MEJIA DUQUE</option>
                                <option value="HERNANDO PÁEZ">HERNANDO PÁEZ</option>
                                <option value="HILDA MARIA SÁENZ">HILDA MARIA SÁENZ</option>
                                <option value="HUGO F KERGUELEM G">HUGO F KERGUELEM G</option>
                                <option value="JAIME CARDENAS">JAIME CARDENAS</option>
                                <option value="JORGE GOMEZ PAVAJEAU">JORGE GOMEZ PAVAJEAU</option>
                                <option value="JOSE GUSTAVO SILVA PEREZ">JOSE GUSTAVO SILVA PEREZ</option>
                                <option value="JOSE RICARDO CASTAÑO">JOSE RICARDO CASTAÑO</option>
                                <option value="JUAN BERNARDO VELASQUEZ PORTILLO">JUAN BERNARDO VELASQUEZ PORTILLO</option>
                                <option value="JUAN MANUEL DIEZ RUSCHER">JUAN MANUEL DIEZ RUSCHER</option>
                                <option value="JUAN PABÓN HERNÁNDEZ">JUAN PABÓN HERNÁNDEZ</option>
                                <option value="LUIS FERNANDO VELEZ">LUIS FERNANDO VELEZ</option>
                                <option value="MARGARITA POLANCO">MARGARITA POLANCO</option>
                                <option value="MARIA MARGARITA CABELLO">MARIA MARGARITA CABELLO</option>
                                <option value="MAURICIO URICOECHEA">MAURICIO URICOECHEA</option>
                                <option value="MAURICIO WAKED MACHADO">MAURICIO WAKED MACHADO</option>
                                <option value="MIGUEL RAFAEL MENDEZ">MIGUEL RAFAEL MENDEZ</option>
                                <option value="MÓNICA I SAAVEDRA MAC AUSLAND">MÓNICA I SAAVEDRA MAC AUSLAND</option>
                                <option value="OCTAVIO VASQUEZ BERMÚDEZ">OCTAVIO VASQUEZ BERMÚDEZ</option>
                                <option value="ORLANDO HERNANDEZ LEAL">ORLANDO HERNANDEZ LEAL</option>
                                <option value="PIEDAD INES BURGOS BURGOS">PIEDAD INES BURGOS BURGOS</option>
                                <option value="PREVEO - MARIA MARCELA CLAVIJO Y MIGUEL ANGEL NEITA">PREVEO - MARIA MARCELA CLAVIJO Y MIGUEL ANGEL NEITA</option>
                                <option value="ROLANDO MEJIA">ROLANDO MEJIA</option>
                                <option value="RUBÉN DARIO CARRILLO">RUBÉN DARIO CARRILLO</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tipo de Fiducia</label>
                            <select class="form-select" name="tipodefiducia">
                                <option value="">Seleccione Fiducia</option>
                                <option value="Completa">Completa</option>
                                <option value="Preventas">Preventas</option>
                                <option value="Tesoreria">Tesorería</option>
                                <option value="Nofiducia">No fiducia</option>
                                <option value="Parqueo">Parqueo</option>
                                <option value="Administración Inmuebles">Administración Inmuebles</option>
                                <option value="Multiple">Múltiple</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Fiduciaria</label>
                            <select class="form-select" name="fiduciaria">
                                <option value="">Seleccione Fiduciaria</option>
                                <option value="Fiduciaria Bancolombia S.A.">Fiduciaria Bancolombia S.A.</option>
                                <option value="Alianza Fiduciaria S.A.">Alianza Fiduciaria S.A.</option>
                                <option value="Accion Sociedad Fiduciaria S.A.">Acción Sociedad Fiduciaria S.A.</option>
                                <option value="BBVA Fiduciaria">BBVA Fiduciaria</option>
                                <option value="CorpBanca Sociedad Fiduciaria">CorpBanca Sociedad Fiduciaria</option>
                                <option value="Fiduciaria Colmena S.A.">Fiduciaria Colmena S.A.</option>
                                <option value="Old Mutual Sociedad Fiduciaria S.A.">Old Mutual Sociedad Fiduciaria S.A.</option>
                                <option value="Fiduciaria la Previsora S. A.">Fiduciaria la Previsora S. A.</option>
                                <option value="Fiduciaria Fiducor S.A.">Fiduciaria Fiducor S.A.</option>
                                <option value="Fiduciaria Colpatria S.A.">Fiduciaria Colpatria S.A.</option>
                                <option value="Fiduciaria Popular S.A. -Fiduciar S.A.-">Fiduciaria Popular S.A. -Fiduciar S.A.-</option>
                                <option value="Fiduciaria Corficolombiana S.A.">Fiduciaria Corficolombiana S.A.</option>
                                <option value="Fiduciaria de Occidente S.A. -Fiduoccidente S.A.-">Fiduciaria de Occidente S.A. -Fiduoccidente S.A.-</option>
                                <option value="Fiduciaria Bogota S.A.">Fiduciaria Bogotá S.A.</option>
                                <option value="Helm Fiduciaria S.A.">Helm Fiduciaria S.A.</option>
                                <option value="Cititrust Colombia S.A. Sociedad Fiduciaria">Cititrust Colombia S.A. Sociedad Fiduciaria</option>
                                <option value="Fiduciaria Colpatria S.A.">Fiduciaria Colpatria S.A.</option>
                                <option value="Servitrust GNB Sudameris S.A.">Servitrust GNB Sudameris S.A.</option>
                                <option value="Fiduciaria Central S.A.">Fiduciaria Central S.A.</option>
                                <option value="Fiduagraria S.A.">Fiduagraria S.A.</option>
                                <option value="Fiducoldex">Fiducoldex</option>
                                <option value="Fidudavivienda S.A.">Fidudavivienda S.A.</option>
                                <option value="Fidupais S.A.">Fidupais S.A.</option>
                                <option value="Gestion Fiduciaria S.A.">Gestión Fiduciaria S.A.</option>
                                <option value="Credicorp Capital Fiduciaria S.A.">Credicorp Capital Fiduciaria S.A.</option>
                                <option value="BNP Paribas Fiduciaria S.A.">BNP Paribas Fiduciaria S.A.</option>
                                <option value="BTG Pactual Fiduciaria">BTG PACTUAL FIDUCIARIA</option>
                                <option value="ITAU Fiduciaria S.A.">ITAU Fiduciaria S.A.</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Segmento</label>
                            <select class="form-select" name="segmento">
                                <option value="">Seleccione un segmento</option>
                                <option>Constructor Corporativo</option>
                                <option>Constructor Empresarial</option>
                                <option>Constructor Pyme</option>
                            </select>
                        </div>
                    </div>
                </div>                   
                <!-- Sección 2: Participantes del Proyecto 
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-users me-2"></i>Participantes</h2>
                    <div id="participantes-container">
                        <div class="participante-item">
                            <span class="remove-participante"><i class="fas fa-times-circle"></i></span>
                            <div class="row">
                                <div class="col-md-5 mb-3">
                                    <label class="form-label required-field">Nombre Participante</label>
                                    <input type="text" class="form-control" name="participantes[0][nombre]" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label required-field">Rol</label>
                                    <select class="form-select" name="participantes[0][rol]" required>
                                        <option value="">Seleccione un rol</option>
                                        <option>Arquitecto</option>
                                        <option>Gerente</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label required-field">Participación</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" name="participantes[0][participacion]" required>
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="btn-add-participante" class="btn btn-outline-primary">
                        <i class="fas fa-plus me-2"></i>Agregar Participante
                    </button>
                </div> -->
                
                <!-- Sección 3: Montos y Valores -->
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-money-bill-wave me-2"></i>Montos y Valores</h2>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Monto Solicitado 1 Desembolso</label>
                            <input type="number" class="form-control" name="monto_desembolso">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Monto Solicitado CPI</label>
                            <input type="number" class="form-control" name="monto_cpi">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Monto Solicitado Lote</label>
                            <input type="number" class="form-control" name="monto_lote">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Total Valor Aprobado</label>
                            <input type="number" class="form-control" name="total_aprobado" readonly>
                            <small class="text-muted">Suma automática de montos</small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Calificación IT</label>
                            <input type="number" step="0.01" class="form-control" name="calificacion_it">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Costos Financiables</label>
                            <input type="number" class="form-control" name="costos_financiables">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Valor Lote</label>
                            <input type="number" class="form-control" name="valor_lote">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Valor Total Proyecto</label>
                            <input type="number" class="form-control" name="valor_total_proyecto">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Meses Programación</label>
                            <input type="number" class="form-control" name="meses_programacion">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Total de Inmuebles</label>
                            <input type="number" class="form-control" name="total_inmuebles">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Meses para Venta</label>
                            <input type="number" class="form-control" name="meses_venta" value="12">
                        </div>
                    </div>
                </div>
                {# {% endif %} #}
                {# {% if session.usuario.rol in ['admin', 'auxiliar'] %} #}
                <div class="form-section">
                    <h2 class="section-title"><i class="fas fa-folder-open me-2"></i>Seleccionar Proyecto Existente</h2>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <select class="form-select" id="seleccionar-proyecto">
                                <option value="">Seleccione un proyecto...</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-section auxiliar-section" id="form-seccion4">
                    <h2 class="section-title"><i class="fas fa-file-contract me-2"></i>Aprobación de Crédito</h2>
                    
                    <div class="row">
                        <!-- <div class="col-md-4 mb-3">
                            <label class="form-label">CASO PCP BIZAGI</label>
                            <div class="input-group">
                                <input type="text" class="form-control" name="caso_pcp_bizagi" placeholder="Texto">
                            </div>
                        </div> -->
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">VISITAS A COBRAR</label>
                            <div class="input-group">
                                <input type="number" class="form-control" name="visitas_a_cobrar">
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">COBRAR ESTUDIO TÉCNICO</label>
                            <select class="form-select" name="cobrar_estudio_tecnico">
                                <option value="">Seleccione una opción</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">FECHA DE APROBACIÓN</label>
                            <input type="date" class="form-control" name="fecha_aprobacion">
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">ALERTA FECHA APROBACIÓN</label>
                            <input type="date" class="form-control bg-warning" name="alerta_fecha" readonly>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">VIGENCIA EN MESES</label>
                            <div class="input-group">
                                <input type="number" class="form-control" name="vigencia_en_meses">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">INSTANCIA DE APROBACIÓN</label>
                            <select class="form-select" name="instancia_aprobacion">
                                <option value="">Seleccionar...</option>
                                <option value="gerencia">Gerencia</option>
                                <option value="comite">Comité Técnico</option>
                                <option value="directorio">Directorio</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">PORCENTAJE SOLICITADO/FINANCIABLES</label>
                            <input type="number" class="form-control" step="0.01" name="porcentaje_solicitado_financiables"
                                placeholder="Cálculo automático" readonly>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="form-label">CONDICIONES DE APROBACIÓN</label>
                            <div class="border p-3" id="condiciones-container">
                                <div class="d-flex align-items-center mb-2">
                                    <input type="text" class="form-control me-2" placeholder="Nueva condición">
                                    <button type="button" class="btn btn-sm btn-primary" onclick="agregarCondicion()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div id="lista-condiciones">
                                    <!-- Las condiciones se añaden aquí con checkboxes y botones -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <button 
                                type="button"
                                id="btn-siguiente-paso"
                                class="btn btn-bancolombia"
                                data-url="{{ url_for('validacion_condiciones') }}"
                                disabled
                                onclick="redirectTo(this)">
                                Validacion condiciones 1er Desembolso
                            </button>
                        </div>
                    </div>
                </div> 
                {# {% endif %} #}
                
                <!-- Botones -->
                <div class="d-flex justify-content-between mt-4">
                    {% if session.usuario.rol in ['admin', 'arquitecto'] %}
                    <div>
                        <button type="button" class="btn btn-outline-success me-2" id="btn-importar">
                            <i class="fas fa-file-import me-2"></i>Importar desde Excel
                        </button>
                    </div>
                    {% endif %}
                    <div>
                        <button type="reset" class="btn btn-outline-secondary me-3">
                            <i class="fas fa-eraser me-2"></i>Limpiar
                        </button>
                        <button type="submit" class="btn btn-bancolombia">
                            <i class="fas fa-save me-2"></i>Guardar Proyecto
                        </button>
                    </div>
                </div>
                
                <!-- Modal para importar -->
                <div class="modal fade" id="importModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Importar desde Excel</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <input type="file" id="excelFile" class="form-control">
                                
                                <!-- Grupo de Riesgo -->
                                <div class="col-md-12 mt-3">
                                    <label class="form-label">Grupo de Riesgo (Carpeta Gerencial)</label>
                                    <input list="grupo_de_riesgo-list2" class="form-select" name="grupo_de_riesgo" id="grupo_riesgoInput2">
                                    

                                    <datalist id="grupo_de_riesgo-list2">
                                        <option value="">Seleccione un grupo de riesgo</option>
                                        <option value="AB INGENIERIA SAS">AB INGENIERIA SAS</option>
                                        <option value="ACIERTO INMOBILIARIO SA">ACIERTO INMOBILIARIO SA</option>
                                        <option value="AED CONSTRUCTORES SAS">AED CONSTRUCTORES SAS</option>
                                        <option value="A+C CONSTRUCTORA">A+C CONSTRUCTORA</option>
                                        <option value="A2 CONSTRUCTORA SAS">A2 CONSTRUCTORA SAS</option>
                                        <option value="A3 COUNSULTING">A3 COUNSULTING</option>
                                        <option value="ACRECER">ACRECER</option>
                                        <option value="ACTUAL COLOMBIA SAS">ACTUAL COLOMBIA SAS</option>
                                        <option value="AKILA SAS">AKILA SAS</option>
                                        <option value="ALCANTARA CONSTRUCTORA SAS">ALCANTARA CONSTRUCTORA SAS</option>
                                        <option value="AMARILO SAS">AMARILO SAS</option>
                                        <option value="AMBIENTTI CONSTRUCTORA INMOBILIARIA">AMBIENTTI CONSTRUCTORA INMOBILIARIA</option>
                                        <option value="ANDES DESARROLLADORA S.A.S.">ANDES DESARROLLADORA S.A.S.</option>
                                        <option value="AP INGENIERÍA LTDA">AP INGENIERÍA LTDA</option>
                                        <option value="ARANJUEZ CONSTRUCCIONES INMOBILIARIAS">ARANJUEZ CONSTRUCCIONES INMOBILIARIAS</option>
                                        <option value="AREA CUADRADA">AREA CUADRADA</option>
                                        <option value="AREA URBANA DISEÑO Y CONSTRUCCION SAS">AREA URBANA DISEÑO Y CONSTRUCCION SAS</option>
                                        <option value="ARIAS SERNA Y SARAVIA">ARIAS SERNA Y SARAVIA</option>
                                        <option value="ARKTEC CONSTRUCTORA SAS">ARKTEC CONSTRUCTORA SAS</option>
                                        <option value="ARQUIAMBIENTAL SAS">ARQUIAMBIENTAL SAS</option>
                                        <option value="ARQUIURBE LTDA">ARQUIURBE LTDA</option>
                                        <option value="ARQUITECTOS CONSTRUCTORES ASOCIADOS">ARQUITECTOS CONSTRUCTORES ASOCIADOS</option>
                                        <option value="ARQUITECTURA Y CONCRETO">ARQUITECTURA Y CONCRETO</option>
                                        <option value="ARVINCO">ARVINCO</option>
                                        <option value="ASUL SAS">ASUL SAS</option>
                                        <option value="ATLANTIS CONSTRUCTORA LTDA">ATLANTIS CONSTRUCTORA LTDA</option>
                                        <option value="AVENIDA COLOMBIA PEF">AVENIDA COLOMBIA PEF</option>
                                        <option value="A UNO PROMOTORES">A UNO PROMOTORES</option>
                                        <option value="BASA CONSTRUCCIONES SAS">BASA CONSTRUCCIONES SAS</option>
                                        <option value="BESCO COLOMBIA SAS">BESCO COLOMBIA SAS</option>
                                        <option value="BIENES Y BIENES SA">BIENES Y BIENES SA</option>
                                        <option value="BOHIOS URBANOS SAS">BOHIOS URBANOS SAS</option>
                                        <option value="BRAZZO CONSTRUCTORES">BRAZZO CONSTRUCTORES</option>
                                        <option value="BREK SAS">BREK SAS</option>
                                        <option value="BRICCON SAS">BRICCON SAS</option>
                                        <option value="C.A.S.A.">C.A.S.A.</option>
                                        <option value="CA VENTURES COLOMBIA S.A.S.">CA VENTURES COLOMBIA S.A.S.</option>
                                        <option value="CADINCO">CADINCO</option>
                                        <option value="CANALES DESARROLLADORES S.A.S">CANALES DESARROLLADORES S.A.S</option>
                                        <option value="CANO H INGENIERIA S.A.S">CANO H INGENIERIA S.A.S</option>
                                        <option value="CASACTIVA">CASACTIVA</option>
                                        <option value="CGR INGENIERIA Y GERENCIA DE PROYECTOS SAS">CGR INGENIERIA Y GERENCIA DE PROYECTOS SAS</option>
                                        <option value="CG CONSTRUCTORA S.A.S">CG CONSTRUCTORA S.A.S</option>
                                        <option value="CHACÓN CONSTRUCCIONES SAS">CHACÓN CONSTRUCCIONES SAS</option>
                                        <option value="CINCO URBANA SAS">CINCO URBANA SAS</option>
                                        <option value="CNV CONSTRUCCIONES SAS">CNV CONSTRUCCIONES SAS</option>
                                        <option value="COALA ARQUITECTURA Y CONSTRUCCION">COALA ARQUITECTURA Y CONSTRUCCION</option>
                                        <option value="COENCO">COENCO</option>
                                        <option value="COHALA CONSTRUCCIONES S.A.S.">COHALA CONSTRUCCIONES S.A.S.</option>
                                        <option value="COINGSA S.A.S">COINGSA S.A.S</option>
                                        <option value="COLOMBIANA DE CONSTRUCCIONES SAS">COLOMBIANA DE CONSTRUCCIONES SAS</option>
                                        <option value="CONACIERTO INGENIERIA ARQUITECTURA S.A.S">CONACIERTO INGENIERIA ARQUITECTURA S.A.S</option>
                                        <option value="CONALTURA S.A.">CONALTURA S.A.</option>
                                        <option value="CONASEL INGENIERIA S.A.S.">CONASEL INGENIERIA S.A.S.</option>
                                        <option value="CONENCO">CONENCO</option>
                                        <option value="CONEXO INMOBILIARIO SAS">CONEXO INMOBILIARIO SAS</option>
                                        <option value="CONIGSA">CONIGSA</option>
                                        <option value="CONINSA SAS">CONINSA SAS</option>
                                        <option value="CONINTEL S.A.">CONINTEL S.A.</option>
                                        <option value="CONSTRUCCIONES BUEN VIVIR S.A.">CONSTRUCCIONES BUEN VIVIR S.A.</option>
                                        <option value="CONSTRUCCIONES CARAN S.A.S">CONSTRUCCIONES CARAN S.A.S</option>
                                        <option value="CONSTRUCCIONES CFC Y ASOCIADOS">CONSTRUCCIONES CFC Y ASOCIADOS</option>
                                        <option value="CONSTRUCCIONES MACRO S.A.S">CONSTRUCCIONES MACRO S.A.S</option>
                                        <option value="CONSTRUCCIONES RIVAS MORA SAS">CONSTRUCCIONES RIVAS MORA SAS</option>
                                        <option value="CONSTRUCCIONES RCG">CONSTRUCCIONES RCG</option>
                                        <option value="CONSTRUCCIONES URBANAS S.A.S.">CONSTRUCCIONES URBANAS S.A.S.</option>
                                        <option value="CONSTRUCCIONES Y NEGOCIOS SYLCO S.A.S.">CONSTRUCCIONES Y NEGOCIOS SYLCO S.A.S.</option>
                                        <option value="CONSTRUCCIONES Y URBANIZACIONES SAS">CONSTRUCCIONES Y URBANIZACIONES SAS</option>
                                        <option value="CONSTRUMAX">CONSTRUMAX</option>
                                        <option value="CONSTRUCTORA 1A S.A.S">CONSTRUCTORA 1A S.A.S</option>
                                        <option value="CONSTRUCTORA ALHAMBRA - FORJAR">CONSTRUCTORA ALHAMBRA - FORJAR</option>
                                        <option value="CONSTRUCTORA ALPES S.A">CONSTRUCTORA ALPES S.A</option>
                                        <option value="CONSTRUCTORA ARQUIMEG">CONSTRUCTORA ARQUIMEG</option>
                                        <option value="CONSTRUCTORA ASCENSO">CONSTRUCTORA ASCENSO</option>
                                        <option value="CONSTRUCTORA BALCONES S.A.S">CONSTRUCTORA BALCONES S.A.S</option>
                                        <option value="CONSTRUCTORA BOLIVAR CALI S.A.">CONSTRUCTORA BOLIVAR CALI S.A.</option>
                                        <option value="CONSTRUCTORA BOLIVAR S.A.">CONSTRUCTORA BOLIVAR S.A.</option>
                                        <option value="CONSTRUCTORA CANALKI S.A.S">CONSTRUCTORA CANALKI S.A.S</option>
                                        <option value="CONSTRUCTORA CAPITAL BOGOTA">CONSTRUCTORA CAPITAL BOGOTA</option>
                                        <option value="CONSTRUCTORA CAPITAL MEDELLÍN">CONSTRUCTORA CAPITAL MEDELLÍN</option>
                                        <option value="CONSTRUCTORA CARVAJAL Y RIVERA SAS">CONSTRUCTORA CARVAJAL Y RIVERA SAS</option>
                                        <option value="CONSTRUCTORA CONFUTURO">CONSTRUCTORA CONFUTURO</option>
                                        <option value="CONSTRUCTORA CONCONCRETO">CONSTRUCTORA CONCONCRETO</option>
                                        <option value="CONSTRUCTORA CONTEX SAS">CONSTRUCTORA CONTEX SAS</option>
                                        <option value="CONSTRUCTORA CONCRETAR S.A.S.">CONSTRUCTORA CONCRETAR S.A.S.</option>
                                        <option value="CONSTRUCTORA COSENZA">CONSTRUCTORA COSENZA</option>
                                        <option value="CONSTRUCTORA COVIN S.A.">CONSTRUCTORA COVIN S.A.</option>
                                        <option value="CONSTRUCTORA COLPATRIA S.A.">CONSTRUCTORA COLPATRIA S.A.</option>
                                        <option value="CONSTRUCTORA DARCO SAS">CONSTRUCTORA DARCO SAS</option>
                                        <option value="CONSTRUCTORA DEL TORO">CONSTRUCTORA DEL TORO</option>
                                        <option value="CONSTRUCTORA EL CASTILLO">CONSTRUCTORA EL CASTILLO</option>
                                        <option value="CONSTRUCTORA EL RUIZ">CONSTRUCTORA EL RUIZ</option>
                                        <option value="CONSTRUCTORA EXPERTA SAS">CONSTRUCTORA EXPERTA SAS</option>
                                        <option value="CONSTRUCTORA FCP AVENIDA COLOMBIA PEF II">CONSTRUCTORA FCP AVENIDA COLOMBIA PEF II</option>
                                        <option value="CONSTRUCTORA GARPRO SAS">CONSTRUCTORA GARPRO SAS</option>
                                        <option value="CONSTRUCTORA GARZON HOLGUIN GYH">CONSTRUCTORA GARZON HOLGUIN GYH</option>
                                        <option value="CONSTRUCTORA HABITAMOS SAS">CONSTRUCTORA HABITAMOS SAS</option>
                                        <option value="CONSTRUCTORA HABITAT DE LOS ANDES">CONSTRUCTORA HABITAT DE LOS ANDES</option>
                                        <option value="CONSTRUCTORA INLASA S.A.S">CONSTRUCTORA INLASA S.A.S</option>
                                        <option value="CONSTRUCTORA INMOBILAIRIA FRATELLI S.A.S.">CONSTRUCTORA INMOBILAIRIA FRATELLI S.A.S.</option>
                                        <option value="CONSTRUCTORA JK SALCEDO SAS">CONSTRUCTORA JK SALCEDO SAS</option>
                                        <option value="CONSTRUCTORA J Y P SAS">CONSTRUCTORA J Y P SAS</option>
                                        <option value="CONSTRUCTORA JIMENEZ S.A.">CONSTRUCTORA JIMENEZ S.A.</option>
                                        <option value="CONSTRUCTORA KOVOK S.A.S.">CONSTRUCTORA KOVOK S.A.S.</option>
                                        <option value="CONSTRUCTORA LAS GALIAS S.A">CONSTRUCTORA LAS GALIAS S.A</option>
                                        <option value="CONSTRUCTORA LARES">CONSTRUCTORA LARES</option>
                                        <option value="CONSTRUCTORA MADECONS SA">CONSTRUCTORA MADECONS SA</option>
                                        <option value="CONSTRUCTORA MAGATA CONSTRCUTORA SAS">CONSTRUCTORA MAGATA CONSTRCUTORA SAS</option>
                                        <option value="CONSTRUCTORA MARQUIS S.A.">CONSTRUCTORA MARQUIS S.A.</option>
                                        <option value="CONSTRUCTORA MATISSE S.A.S">CONSTRUCTORA MATISSE S.A.S</option>
                                        <option value="CONSTRUCTORA MELENDEZ S.A.">CONSTRUCTORA MELENDEZ S.A.</option>
                                        <option value="CONSTRUCTORA MMVR S.A.S">CONSTRUCTORA MMVR S.A.S</option>
                                        <option value="CONSTRUCTORA MONSERRATE">CONSTRUCTORA MONSERRATE</option>
                                        <option value="CONSTRUCTORA MURAGLIA S.A.">CONSTRUCTORA MURAGLIA S.A.</option>
                                        <option value="CONSTRUCTORA OPEN">CONSTRUCTORA OPEN</option>
                                        <option value="CONSTRUCTORA ORIGEN">CONSTRUCTORA ORIGEN</option>
                                        <option value="CONSTRUCTORA PLINCO S.A.">CONSTRUCTORA PLINCO S.A.</option>
                                        <option value="CONSTRUCTORA PRIMAR SA">CONSTRUCTORA PRIMAR SA</option>
                                        <option value="CONSTRUCTORA PROYECTOS URBANOS SAS">CONSTRUCTORA PROYECTOS URBANOS SAS</option>
                                        <option value="CONSTRUCTORA RIO AZUL">CONSTRUCTORA RIO AZUL</option>
                                        <option value="CONSTRUCTORA RIVER PARK SAS">CONSTRUCTORA RIVER PARK SAS</option>
                                        <option value="CONSTRUCTORA SOLANILLAS S.A">CONSTRUCTORA SOLANILLAS S.A</option>
                                        <option value="CONSTRUCTORA SOLIDER S.A.S.">CONSTRUCTORA SOLIDER S.A.S.</option>
                                        <option value="CONSTRUCTORA SUDAMERICANA">CONSTRUCTORA SUDAMERICANA</option>
                                        <option value="CONSTRUCTORA TEYPRO">CONSTRUCTORA TEYPRO</option>
                                        <option value="CONSTRUCTORA TORRES DE LA FRANCIA">CONSTRUCTORA TORRES DE LA FRANCIA</option>
                                        <option value="CONSTRUCTORA YADEL S.A.S.">CONSTRUCTORA YADEL S.A.S.</option>
                                        <option value="CONSTRUCTORA Y COMERCIALIZADORA CAMU">CONSTRUCTORA Y COMERCIALIZADORA CAMU</option>
                                        <option value="CONSTRUCTORA Y COMERCIALIZADORA POPORO">CONSTRUCTORA Y COMERCIALIZADORA POPORO</option>
                                        <option value="CONSTRUCTORA Y DESARROLLOS RENGIFO">CONSTRUCTORA Y DESARROLLOS RENGIFO</option>
                                        <option value="CONVALLE CONSTRUCTORA S.A.S">CONVALLE CONSTRUCTORA S.A.S</option>
                                        <option value="CONVEL SAS">CONVEL SAS</option>
                                        <option value="COTESAB S.A.S">COTESAB S.A.S</option>
                                        <option value="CREANDO ARQUITECTURA S.A.S.">CREANDO ARQUITECTURA S.A.S.</option>
                                        <option value="CUBYCO CONSTRUCTORES S.A.">CUBYCO CONSTRUCTORES S.A.</option>
                                        <option value="CVA CONTRUCTORA SAS">CVA CONTRUCTORA SAS</option>
                                        <option value="CYMADE">CYMADE</option>
                                        <option value="DEGA S.A.S.">DEGA S.A.S.</option>
                                        <option value="DEEB ASOCIADOS S.A.S">DEEB ASOCIADOS S.A.S</option>
                                        <option value="DESARROLLOS INMOBILIARIOS FUTURO SAS">DESARROLLOS INMOBILIARIOS FUTURO SAS</option>
                                        <option value="DIPRECON SAS">DIPRECON SAS</option>
                                        <option value="DISTEMACO S.A.S">DISTEMACO S.A.S</option>
                                        <option value="DIVERSIFICAR SA">DIVERSIFICAR SA</option>
                                        <option value="DOM REAL ESTATE">DOM REAL ESTATE</option>
                                        <option value="DUQUE RENGIFO">DUQUE RENGIFO</option>
                                        <option value="DYCO S.A.S.">DYCO S.A.S.</option>
                                        <option value="ECINSA INGENIERIA S.A.S.">ECINSA INGENIERIA S.A.S.</option>
                                        <option value="ECOSSUR S.A.S">ECOSSUR S.A.S</option>
                                        <option value="EDC CONSTRUCCIONES S.A.S">EDC CONSTRUCCIONES S.A.S</option>
                                        <option value="EDIFICADORA RIOVISTA S.A.S">EDIFICADORA RIOVISTA S.A.S</option>
                                        <option value="EDIFICALIA S.A.S">EDIFICALIA S.A.S</option>
                                        <option value="ENPROYECTOS S.A.S">ENPROYECTOS S.A.S</option>
                                        <option value="EQUANIME SAS">EQUANIME SAS</option>
                                        <option value="ESDIEZ CONSTRUCTORA S.A.S">ESDIEZ CONSTRUCTORA S.A.S</option>
                                        <option value="ESFÉRICA S.A.S">ESFÉRICA S.A.S</option>
                                        <option value="ESPACIO VITAL CONSTRUCTORES SA">ESPACIO VITAL CONSTRUCTORES SA</option>
                                        <option value="ESTRUCTURAR INFRAESTRUCTURA SAS">ESTRUCTURAR INFRAESTRUCTURA SAS</option>
                                        <option value="FAKTOR">FAKTOR</option>
                                        <option value="FCR SAS">FCR SAS</option>
                                        <option value="FENIX CONSTRUCCIONES S.A.">FENIX CONSTRUCCIONES S.A.</option>
                                        <option value="FIC">FIC</option>
                                        <option value="G4 INGENIEROS CIVILES S.A.S.">G4 INGENIEROS CIVILES S.A.S.</option>
                                        <option value="GERENCIA MÁS PROYECTOS S.A.S">GERENCIA MÁS PROYECTOS S.A.S</option>
                                        <option value="GESTION Y GERENCIA">GESTION Y GERENCIA</option>
                                        <option value="GIDACOL SAS">GIDACOL SAS</option>
                                        <option value="GRAMA">GRAMA</option>
                                        <option value="GRAN MORADA CONSTRUCCIONES">GRAN MORADA CONSTRUCCIONES</option>
                                        <option value="GRUPO ACCANTO">GRUPO ACCANTO</option>
                                        <option value="GRUPO AR">GRUPO AR</option>
                                        <option value="GRUPO BGR">GRUPO BGR</option>
                                        <option value="GRUPO CONSTRUCTOR CALIBIO">GRUPO CONSTRUCTOR CALIBIO</option>
                                        <option value="GRUPO EMPRESARIAL KINKU">GRUPO EMPRESARIAL KINKU</option>
                                        <option value="GRUPO GERENCIAR">GRUPO GERENCIAR</option>
                                        <option value="GRUPO GUASANDI (ANTES CDO)">GRUPO GUASANDI (ANTES CDO)</option>
                                        <option value="GRUPO INMOBILIARIO PAISAJE URBANO SAS">GRUPO INMOBILIARIO PAISAJE URBANO SAS</option>
                                        <option value="GRUPO INMOBILIARIO Y CONSTRUCTOR VALOR SA">GRUPO INMOBILIARIO Y CONSTRUCTOR VALOR SA</option>
                                        <option value="GRUPO LORCA">GRUPO LORCA</option>
                                        <option value="GRUPO MOYUA">GRUPO MOYUA</option>
                                        <option value="GRUPO OIKOS S.A.">GRUPO OIKOS S.A.</option>
                                        <option value="GRUPO QUARTO">GRUPO QUARTO</option>
                                        <option value="GRUPO SOLERIUM">GRUPO SOLERIUM</option>
                                        <option value="GRUPO VS LIMITADA">GRUPO VS LIMITADA</option>
                                        <option value="HAYUELOS DE COLOMBIA S.A.S">HAYUELOS DE COLOMBIA S.A.S</option>
                                        <option value="HITOS URBANOS S.A.S">HITOS URBANOS S.A.S</option>
                                        <option value="IARCO S.A.">IARCO S.A.</option>
                                        <option value="ICONO URBANO S.A.">ICONO URBANO S.A.</option>
                                        <option value="IMOVAL">IMOVAL</option>
                                        <option value="INACAR S.A">INACAR S.A</option>
                                        <option value="INDIVA DESIGN S.A.S.">INDIVA DESIGN S.A.S.</option>
                                        <option value="INGEARCO Y GRUPO CIUDADELA">INGEARCO Y GRUPO CIUDADELA</option>
                                        <option value="INGENAL S.A.">INGENAL S.A.</option>
                                        <option value="INGENIA CONSTRUCCIONES S.A.S">INGENIA CONSTRUCCIONES S.A.S</option>
                                        <option value="INGENIERIA INMOBILIARIA S.A.">INGENIERIA INMOBILIARIA S.A.</option>
                                        <option value="INGENIERIA Y HERRAMIENTAS S.A.S">INGENIERIA Y HERRAMIENTAS S.A.S</option>
                                        <option value="INGENIERIA Y VIVIENDA SAS">INGENIERIA Y VIVIENDA SAS</option>
                                        <option value="INGENOVA ING">INGENOVA ING</option>
                                        <option value="INMOBILIARIA DALI">INMOBILIARIA DALI</option>
                                        <option value="INMOBILIARIA PROACTIVA SA">INMOBILIARIA PROACTIVA SA</option>
                                        <option value="INMOVEL">INMOVEL</option>
                                        <option value="INSERCO">INSERCO</option>
                                        <option value="INTEGRA GERENCIA Y CONSTRUCCIONES SAS">INTEGRA GERENCIA Y CONSTRUCCIONES SAS</option>
                                        <option value="INTORNO">INTORNO</option>
                                        <option value="INUBERCO">INUBERCO</option>
                                        <option value="INVERSIONES HYH LTDA">INVERSIONES HYH LTDA</option>
                                        <option value="INVERSIONES HARI SAS">INVERSIONES HARI SAS</option>
                                        <option value="INVERSIONES LA CAROLINA S.A.S.">INVERSIONES LA CAROLINA S.A.S.</option>
                                        <option value="INVERSIONES LA PENINSULA LTDA">INVERSIONES LA PENINSULA LTDA</option>
                                        <option value="INVERSIONES MAGLA">INVERSIONES MAGLA</option>
                                        <option value="INVERSIONES NT3 S.A.S">INVERSIONES NT3 S.A.S</option>
                                        <option value="INVERSIONES OYAGA 1323 S.A.S">INVERSIONES OYAGA 1323 S.A.S</option>
                                        <option value="INVERSIONES POLARIS">INVERSIONES POLARIS</option>
                                        <option value="INVERSIONES PROMEXPORT S.A.S.">INVERSIONES PROMEXPORT S.A.S.</option>
                                        <option value="INVERSIONES RODAS - INVERSIONES MAGLA">INVERSIONES RODAS - INVERSIONES MAGLA</option>
                                        <option value="INVERSIONES TERRA S.A.">INVERSIONES TERRA S.A.</option>
                                        <option value="INVERSIONES TORRELAVEGA SAS">INVERSIONES TORRELAVEGA SAS</option>
                                        <option value="INVERSIONES VALLE DEL PACIFICO INVERFIN">INVERSIONES VALLE DEL PACIFICO INVERFIN</option>
                                        <option value="IPC INMOBILIARIO SAS">IPC INMOBILIARIO SAS</option>
                                        <option value="JAER GERENCIA DE PROYECTOS">JAER GERENCIA DE PROYECTOS</option>
                                        <option value="JARAMILLO ARQUITECTOS">JARAMILLO ARQUITECTOS</option>
                                        <option value="JARAMILLO MORA">JARAMILLO MORA</option>
                                        <option value="J. FELIPE ARDILA">J. FELIPE ARDILA</option>
                                        <option value="J. PACHON SOCIEDAD POR ACCIONES">J. PACHON SOCIEDAD POR ACCIONES</option>
                                        <option value="JS INGENERIA Y CONSTRUCCIONES SAS">JS INGENERIA Y CONSTRUCCIONES SAS</option>
                                        <option value="JULIO CESAR GUERRERO">JULIO CESAR GUERRERO</option>
                                        <option value="KREAR CONSTRUCTORES S.A.S">KREAR CONSTRUCTORES S.A.S</option>
                                        <option value="KROMO">KROMO</option>
                                        <option value="KUMAN SAS">KUMAN SAS</option>
                                        <option value="LA CONSTRUCTORA">LA CONSTRUCTORA</option>
                                        <option value="LEGF CONSTRUCTORA SAS">LEGF CONSTRUCTORA SAS</option>
                                        <option value="LEON AGUILERA S.A.">LEON AGUILERA S.A.</option>
                                        <option value="LG INVERSIONES - GRUPO DESARROLLADOR SABANA">LG INVERSIONES - GRUPO DESARROLLADOR SABANA</option>
                                        <option value="LONDOÑO GOMEZ">LONDOÑO GOMEZ</option>
                                        <option value="LOPEZ CUBILLOS CONSTRUCCIONES SAS">LOPEZ CUBILLOS CONSTRUCCIONES SAS</option>
                                        <option value="L&L CONSTRUCCIONES CON DISEÑO SAS">L&L CONSTRUCCIONES CON DISEÑO SAS</option>
                                        <option value="LUQUE OSPINA">LUQUE OSPINA</option>
                                        <option value="M+D CONSTRUCTORA">M+D CONSTRUCTORA</option>
                                        <option value="MAYA Y ASOCIADOS SAS">MAYA Y ASOCIADOS SAS</option>
                                        <option value="MANDAL CONSTRUCCIONES S.A.S.">MANDAL CONSTRUCCIONES S.A.S.</option>
                                        <option value="MARVAL SA">MARVAL SA</option>
                                        <option value="MEJIA VILLEGAS CONSTRUCTORES S.A.">MEJIA VILLEGAS CONSTRUCTORES S.A.</option>
                                        <option value="MENSULA S.A.">MENSULA S.A.</option>
                                        <option value="MEVIC">MEVIC</option>
                                        <option value="MG CONSTRUCCIONES Y EQUIPOS S.A.S.">MG CONSTRUCCIONES Y EQUIPOS S.A.S.</option>
                                        <option value="MGJ">MGJ</option>
                                        <option value="MIPKO CONSTRUCTORES S.A.S.">MIPKO CONSTRUCTORES S.A.S.</option>
                                        <option value="MOSEL S.A.S.">MOSEL S.A.S.</option>
                                        <option value="MOVEC SAS">MOVEC SAS</option>
                                        <option value="MULTICONSTRUCCIONES JP">MULTICONSTRUCCIONES JP</option>
                                        <option value="MUISCA CONSTRUCCIONES SAS">MUISCA CONSTRUCCIONES SAS</option>
                                        <option value="NATURA SAS">NATURA SAS</option>
                                        <option value="NUCLEO CONSTRUCTORA S.A.S.">NUCLEO CONSTRUCTORA S.A.S.</option>
                                        <option value="NT GROUP SAS">NT GROUP SAS</option>
                                        <option value="NUEVO HORIZONTE">NUEVO HORIZONTE</option>
                                        <option value="OBRAS CIVILES Y ACABADOS">OBRAS CIVILES Y ACABADOS</option>
                                        <option value="OBRAS Y MAQUINAS S.A.S">OBRAS Y MAQUINAS S.A.S</option>
                                        <option value="ODICCO LTDA">ODICCO LTDA</option>
                                        <option value="ONCE CONSTRUCTORA S.A.S.">ONCE CONSTRUCTORA S.A.S.</option>
                                        <option value="OPA CONSTRUCTORES S.A.">OPA CONSTRUCTORES S.A.</option>
                                        <option value="OPTIMA S.A.">OPTIMA S.A.</option>
                                        <option value="OPTIMO INVERSIONES S.A.S.">OPTIMO INVERSIONES S.A.S.</option>
                                        <option value="ORBE SAS CONSTRUCCIONES">ORBE SAS CONSTRUCCIONES</option>
                                        <option value="ORGANIZACION CENTENARIO">ORGANIZACION CENTENARIO</option>
                                        <option value="ORGANIZACION EDYFICA SA">ORGANIZACION EDYFICA SA</option>
                                        <option value="ORMECO">ORMECO</option>
                                        <option value="PACTAR DESARROLLADOR INMOBILIARIO S.A.S.">PACTAR DESARROLLADOR INMOBILIARIO S.A.S.</option>
                                        <option value="PADILLA MORENO">PADILLA MORENO</option>
                                        <option value="PALACIO OFICINA DE CONSTRUCCIONES S.A">PALACIO OFICINA DE CONSTRUCCIONES S.A</option>
                                        <option value="PCA SOLUCIONES ARQUITECTONICAS SAS">PCA SOLUCIONES ARQUITECTONICAS SAS</option>
                                        <option value="PEDRO GOMEZ Y CIA">PEDRO GOMEZ Y CIA</option>
                                        <option value="PETRUS LURA S.A.S">PETRUS LURA S.A.S</option>
                                        <option value="PLANEACIÓN Y EDIFICACIÓN S.A.S.">PLANEACIÓN Y EDIFICACIÓN S.A.S.</option>
                                        <option value="PLATAFORMA CONSTRUCTORES SAS">PLATAFORMA CONSTRUCTORES SAS</option>
                                        <option value="POTENCO S.A.S">POTENCO S.A.S</option>
                                        <option value="PPM INVERSIONES S.A.">PPM INVERSIONES S.A.</option>
                                        <option value="PROACTIV SAS">PROACTIV SAS</option>
                                        <option value="PRODESA">PRODESA</option>
                                        <option value="PROGRESSIVE HORIZON">PROGRESSIVE HORIZON</option>
                                        <option value="PROHOGAR">PROHOGAR</option>
                                        <option value="PROIN">PROIN</option>
                                        <option value="PROINSA SAS">PROINSA SAS</option>
                                        <option value="PROKSOL">PROKSOL</option>
                                        <option value="PROMOTORA 775 S.A.S. Y PROMOTORA MAGNO LOFT">PROMOTORA 775 S.A.S. Y PROMOTORA MAGNO LOFT</option>
                                        <option value="PROMOTORA AIKI">PROMOTORA AIKI</option>
                                        <option value="PROMOTORA ALTO DE PALMAS SAS">PROMOTORA ALTO DE PALMAS SAS</option>
                                        <option value="PROMOTORA APOTEMA SAS">PROMOTORA APOTEMA SAS</option>
                                        <option value="PROMOTORA AZORE S.A.S">PROMOTORA AZORE S.A.S</option>
                                        <option value="PROMOTORA CAMPESTRE">PROMOTORA CAMPESTRE</option>
                                        <option value="PROMOTORA CIBELS S.A.S">PROMOTORA CIBELS S.A.S</option>
                                        <option value="PROMOTORA FORESTA">PROMOTORA FORESTA</option>
                                        <option value="PROMOTORA G 15 S.A.S">PROMOTORA G 15 S.A.S</option>
                                        <option value="PROMOTORA MINT">PROMOTORA MINT</option>
                                        <option value="PROMOTORA NURIA">PROMOTORA NURIA</option>
                                        <option value="PROMOTORA NIVEL SAS">PROMOTORA NIVEL SAS</option>
                                        <option value="PROMOTORA SAN MIGUEL S.A.S">PROMOTORA SAN MIGUEL S.A.S</option>
                                        <option value="PROMOTORA SEAPORT S.A.S">PROMOTORA SEAPORT S.A.S</option>
                                        <option value="PROMOTORA TORICES DEL MAR S.A.S.">PROMOTORA TORICES DEL MAR S.A.S.</option>
                                        <option value="PROMOTORA VIVENDI SAS">PROMOTORA VIVENDI SAS</option>
                                        <option value="PROURBE SA">PROURBE SA</option>
                                        <option value="PROYECTAMOS Y EDIFICAMOS">PROYECTAMOS Y EDIFICAMOS</option>
                                        <option value="PROYECTO ESTRATEGIA LTDA">PROYECTO ESTRATEGIA LTDA</option>
                                        <option value="PROYECTOS DE INGENIERÍA AVANZADA PRINZA">PROYECTOS DE INGENIERÍA AVANZADA PRINZA</option>
                                        <option value="PROYECTOS E INVERSIONES MPL SAS">PROYECTOS E INVERSIONES MPL SAS</option>
                                        <option value="PROYECTOS GIRARDOT Y ALREDEDORES">PROYECTOS GIRARDOT Y ALREDEDORES</option>
                                        <option value="PROYECTOS URBANOS 3L S.A.S.">PROYECTOS URBANOS 3L S.A.S.</option>
                                        <option value="PROYECTOS URBANOS DE COLOMBIA S.A.S.">PROYECTOS URBANOS DE COLOMBIA S.A.S.</option>
                                        <option value="PRANHA S.A">PRANHA S.A</option>
                                        <option value="Q-BICA">Q-BICA</option>
                                        <option value="QUINTERO ARBELAEZ SAS">QUINTERO ARBELAEZ SAS</option>
                                        <option value="R.A.D.F INVERSIONES S.A.S.">R.A.D.F INVERSIONES S.A.S.</option>
                                        <option value="RFP CONSTRUCTORES S.A.S.">RFP CONSTRUCTORES S.A.S.</option>
                                        <option value="RESIDERE S.A.S">RESIDERE S.A.S</option>
                                        <option value="ROBLE CONSTRUCCIONES SAS">ROBLE CONSTRUCCIONES SAS</option>
                                        <option value="RODRIGUEZ BRIÑEZ S.A.S.">RODRIGUEZ BRIÑEZ S.A.S.</option>
                                        <option value="RUIZ AREVALO CONSTRUCTORA S.A.">RUIZ AREVALO CONSTRUCTORA S.A.</option>
                                        <option value="SAHA CONSTRUCCIONES">SAHA CONSTRUCCIONES</option>
                                        <option value="SAVE INVERSIONES Y PROYECTOS S.A.S">SAVE INVERSIONES Y PROYECTOS S.A.S</option>
                                        <option value="SEIKA S.A.S.">SEIKA S.A.S.</option>
                                        <option value="SIMBRA">SIMBRA</option>
                                        <option value="SINTAGMA S.A.S">SINTAGMA S.A.S</option>
                                        <option value="SOHNOS SAS">SOHNOS SAS</option>
                                        <option value="SOLARI INVERSIONES Y DESARROLLOS INMOBILIARIOS SAS">SOLARI INVERSIONES Y DESARROLLOS INMOBILIARIOS SAS</option>
                                        <option value="SOLUCIONES CIVILES">SOLUCIONES CIVILES</option>
                                        <option value="SOLUCIONES CONSTRUCTIVAS S.A.S">SOLUCIONES CONSTRUCTIVAS S.A.S</option>
                                        <option value="SOLUCIONES DE VIVIENDA SV S.A.S">SOLUCIONES DE VIVIENDA SV S.A.S</option>
                                        <option value="SOLUCIONES SIVIS S.A.S">SOLUCIONES SIVIS S.A.S</option>
                                        <option value="SOPROTEC SAS">SOPROTEC SAS</option>
                                        <option value="STOGON CONSTRUCTORA S.A.S">STOGON CONSTRUCTORA S.A.S</option>
                                        <option value="SUMAS CONSTRUCCIONES SAS">SUMAS CONSTRUCCIONES SAS</option>
                                        <option value="SUPERHAVIT-AT">SUPERHAVIT-AT</option>
                                        <option value="TEKTON ARQUITECTURA EI NGENIERIA SAS">TEKTON ARQUITECTURA EI NGENIERIA SAS</option>
                                        <option value="TELVAL S.A.S.">TELVAL S.A.S.</option>
                                        <option value="TERRAPIN SAS">TERRAPIN SAS</option>
                                        <option value="TIERRA GRATA & CO">TIERRA GRATA & CO</option>
                                        <option value="TOUS CONSTRUCTORA">TOUS CONSTRUCTORA</option>
                                        <option value="TRAZOS URBANOS S.A.S.">TRAZOS URBANOS S.A.S.</option>
                                        <option value="TRAMETAL">TRAMETAL</option>
                                        <option value="TRAMONTANA CONSTRUCTORA SAS">TRAMONTANA CONSTRUCTORA SAS</option>
                                        <option value="TRIPLE AAA S.A.S">TRIPLE AAA S.A.S</option>
                                        <option value="TRIADA S.A.S.">TRIADA S.A.S.</option>
                                        <option value="TRUJILLO GUTIERREZ">TRUJILLO GUTIERREZ</option>
                                        <option value="TU CASA PROYECTOS S.A.S.">TU CASA PROYECTOS S.A.S.</option>
                                        <option value="UMBRAL">UMBRAL</option>
                                        <option value="UNION TEMPORAL SANTAMARIA">UNION TEMPORAL SANTAMARIA</option>
                                        <option value="UNOSESENTAIUNO S.A.S.">UNOSESENTAIUNO S.A.S.</option>
                                        <option value="UNO SEIS SAS">UNO SEIS SAS</option>
                                        <option value="URAKI CONSTRUCTORA">URAKI CONSTRUCTORA</option>
                                        <option value="URBAMARES">URBAMARES</option>
                                        <option value="URBANIZAR PEREIRA SAS">URBANIZAR PEREIRA SAS</option>
                                        <option value="VAVILCO">VAVILCO</option>
                                        <option value="VECTOR CONSTRUCCIONES S.A.S.">VECTOR CONSTRUCCIONES S.A.S.</option>
                                        <option value="VERSION URBANA">VERSION URBANA</option>
                                        <option value="VERTICE">VERTICE</option>
                                        <option value="VERTICES URBANOS SAS">VERTICES URBANOS SAS</option>
                                        <option value="VERTIZE">VERTIZE</option>
                                        <option value="VICTORIA ADMINISTRADORES">VICTORIA ADMINISTRADORES</option>
                                        <option value="VIVAL ARQUITECTOS">VIVAL ARQUITECTOS</option>
                                        <option value="VIVIENDAS Y PROYECTOS S.A.S">VIVIENDAS Y PROYECTOS S.A.S</option>
                                    </datalist>
                            </div>
                            <div class="col-md-12 mt-3" id="subgrupos-container2">
                                <label class="form-label">Subgrupos y Porcentajes</label>
                                <div class="input-group mb-2">
                                    <input list="grupo_de_riesgo-list2" 
                                           class="form-control subgrupo-input2" 
                                           placeholder="Subgrupo 1">
                                    <input type="number" class="form-control porcentaje-input2" placeholder="%" step="0.01" min="0" max="100" style="max-width: 100px;">
                                    <button type="button" class="btn btn-success btn-add-subgrupo2">+</button>
                                </div>
                            </div>
                                <!-- Auxiliar -->
                                <div class="col-md-12 mt-3">
                                    <label class="form-label">Auxiliar</label>
                                    <select class="form-select" name="auxiliar">
                                        <option value="">Seleccione Auxiliar</option>
                                        <option value="ANA LUCIA ARANGO">ANA LUCIA ARANGO</option>
                                        <option value="DANIEL CICERO">DANIEL CICERO</option>
                                        <option value="YENIFER PEREZ">YENIFER PEREZ</option>
                                        <option value="CARLOS DAVID ECHEVERRI">CARLOS DAVID ECHEVERRI</option>
                                        <option value="LILIANA DUARTE">LILIANA DUARTE</option>
                                    </select>
                                </div>

                                <div class="alert alert-info mt-3">
                                    El archivo debe tener el mismo formato que el exportado
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" id="btn-confirm-import">Importar</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal de éxito -->
                <div class="modal fade" id="successModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Éxito</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ¡Proyecto creado exitosamente!
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Aceptar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script para manejar el formulario -->
    <script>

    const session = {
        usuario: {
            rol: "{{ session.usuario.rol }}"
        }
    };
     
    // Función para inicializar Choices
    function initializeChoices(select, choicesData = []) {
        if (select._choicesInstance) {
            select._choicesInstance.destroy();
        }

        const choices = new Choices(select, {
            searchEnabled: true,
            choices: choicesData,
            shouldSort: false,
            itemSelectText: '',
            classNames: {
                containerInner: 'choices__inner',
                input: 'choices__input'
            }
        });

        select._choicesInstance = choices;
        return choices;
    }


    function limpiarOpciones(select, placeholder = '') {
        while (select.options.length > 0) {
            select.remove(0);
        }

        if (placeholder) {
            const option = document.createElement('option');
            option.text = placeholder;
            option.value = '';
            select.add(option);
        }
    }

    document.getElementById('lista-condiciones').addEventListener('change', function(e) {
        const checkboxes = this.querySelectorAll('input[type="checkbox"]');
        
        // Verificar si al menos un checkbox está marcado
        const algunCheckeado = Array.from(checkboxes).some(cb => cb.checked);
        document.getElementById('btn-siguiente-paso').disabled = !algunCheckeado;

        // Bloquear el checkbox que se acaba de marcar (evitar desmarcar)
        if(e.target.checked) {
            e.target.disabled = true; // Deshabilita físicamente el checkbox
        }
    });

    function redirectTo(element) {
        window.location.href = element.dataset.url;
    }



    // API Endpoints
    const API_DEPARTAMENTOS_JSON = 'https://raw.githubusercontent.com/marcovega/colombia-json/master/colombia.min.json';

    let listaDepartamentos = [];

    function cargarDepartamentos() {
        fetch(API_DEPARTAMENTOS_JSON)
            .then(res => res.json())
            .then(data => {
                listaDepartamentos = data;
                departamentoSelect.innerHTML = '<option value="">Seleccione un departamento</option>';
                data.forEach(dep => {
                    const option = new Option(dep.departamento, dep.departamento);
                    departamentoSelect.add(option);
                });
                initializeChoices(departamentoSelect);
            })
            .catch(error => console.error('Error cargando departamentos:', error));
    }

    function cargarMunicipios(nombreDepartamento) {
        // Quitar deshabilitado antes de inicializar Choices
        municipioSelect.disabled = false;

        // Destruir instancia Choices si ya existe
        if (municipioSelect._choicesInstance) {
            municipioSelect._choicesInstance.destroy();
            municipioSelect._choicesInstance = null;
        }

        // Limpiar opciones
        municipioSelect.innerHTML = '<option value="">Seleccione un municipio</option>';

        // Buscar el departamento y cargar las ciudades
        const dep = listaDepartamentos.find(d => d.departamento === nombreDepartamento);
        if (dep) {
            dep.ciudades.forEach(ciudad => {
                const option = new Option(ciudad, ciudad);
                municipioSelect.add(option);
            });
        }

        // Re-inicializar Choices
        initializeChoices(municipioSelect);
    }


    // Listener actualizado para departamento
    const departamentoSelect = document.getElementById('departamento');
    const municipioSelect = document.getElementById('municipio');

    departamentoSelect.addEventListener('change', (e) => {
        const selected = e.target.value;
        if (selected) {
            cargarMunicipios(selected);
        } else {
            if (municipioSelect._choicesInstance) {
                municipioSelect._choicesInstance.destroy();
                municipioSelect._choicesInstance = null;
            }
            municipioSelect.innerHTML = '<option value="">Seleccione un departamento primero</option>';
            municipioSelect.disabled = true;
        }
    });

    // Event Listeners
    // departamentoSelect.addEventListener('change', (e) => {
    //     if (e.target.value) {
    //         cargarMunicipios(e.target.value);
    //     } else {
    //         municipioSelect.innerHTML = '<option value="">Seleccione un departamento primero</option>';
    //         municipioSelect.disabled = true;
    //     }
    // });
    
    
    let participanteCount = 1;
    const requiredColumns = ['ID PROYECTO', 'NOMBRE PROYECTO', 'NIT GRUPO DE RIESGO']; // Columnas obligatorias para Excel

    // Función para calcular total aprobado
    const calcularTotalAprobado = () => {
        const monto1 = parseFloat(document.querySelector('[name="monto_desembolso"]')?.value) || 0;
        const monto2 = parseFloat(document.querySelector('[name="monto_cpi"]')?.value) || 0;
        const monto3 = parseFloat(document.querySelector('[name="monto_lote"]')?.value) || 0;
        
        const total = monto1 + monto2 + monto3;
        const totalAprobado = document.querySelector('[name="total_aprobado"]');
        if(totalAprobado) totalAprobado.value = total.toFixed(2);
    };

    // Función para validar campos
    const validarCampos = () => {
        let isValid = true;
        
        // Validar campos principales
        document.querySelectorAll('[required]').forEach(campo => {
            if (!campo?.value.trim()) {
                campo.classList.add('is-invalid');
                isValid = false;
            } else {
                campo.classList.remove('is-invalid');
            }
        });

        // Validar participantes
        const participantes = Array.from(document.querySelectorAll('.participante-item')).filter(item => 
            item.querySelector('[name*="[nombre]"]')?.value && 
            item.querySelector('[name*="[rol]"]')?.value && 
            item.querySelector('[name*="[participacion]"]')?.value
        );
        
        //if(participantes.length === 0) {
        //    alert('Debe agregar al menos un participante válido!');
        //   isValid = false;
        //}

        return isValid;
    };

    // Manejo de subgrupos
    // Para el modal de importar
let subgrupoCount = 1;

document.querySelector('.btn-add-subgrupo').addEventListener('click', function() {
    if (subgrupoCount < 3) {
        subgrupoCount++;
        const newInput = document.createElement('div');
        newInput.className = 'input-group mb-2';
        newInput.innerHTML = `
            <input list="grupo_de_riesgo-list" 
                class="form-control subgrupo-input" 
                placeholder="Subgrupo ${subgrupoCount}">
            <input type="number" class="form-control porcentaje-input" 
                placeholder="%" step="0.01" min="0" max="100" 
                style="max-width: 100px;">
            <button type="button" class="btn btn-danger btn-remove-subgrupo">-</button>
        `;
        document.getElementById('subgrupos-container').appendChild(newInput);
        addPercentageValidation();
    }
});

    // Para el formulario manual
    let subgrupoCount2 = 1;

    document.querySelector('.btn-add-subgrupo2').addEventListener('click', function() {
        if (subgrupoCount2 < 3) {
            subgrupoCount2++;
            const newInput = document.createElement('div');
            newInput.className = 'input-group mb-2';
            newInput.innerHTML = `
                <input list="grupo_de_riesgo-list2" 
                    class="form-control subgrupo-input2" 
                    placeholder="Subgrupo ${subgrupoCount2}">
                <input type="number" class="form-control porcentaje-input2" 
                    placeholder="%" step="0.01" min="0" max="100" 
                    style="max-width: 100px;">
                <button type="button" class="btn btn-danger btn-remove-subgrupo">-</button>
            `;
            document.getElementById('subgrupos-container2').appendChild(newInput);
            addPercentageValidation();
        }
    });

    function addPercentageValidation() {
        // Seleccionar TODOS los inputs de porcentaje (ambos grupos)
        const porcentajeInputs = document.querySelectorAll('[class*="porcentaje-input"]');
        
        const updateTotal = () => {
            let total = 0;
            porcentajeInputs.forEach(input => {
                // Convertir a número y sumar (0 si está vacío)
                total += parseFloat(input.value) || 0; 
            });
            
            // Actualizar display del total
            const totalElement = document.getElementById('total-porcentaje');
            if(totalElement) {
                totalElement.textContent = total.toFixed(2) + '%';
                
                // Cambiar color si supera 100%
                totalElement.style.color = total > 100 ? 'red' : 'inherit';
            }
        };

        // Agregar eventos a TODOS los inputs
        porcentajeInputs.forEach(input => {
            // Asegurar que solo se agregue el evento una vez
            if(!input._percentageListenerAdded) { 
                input.addEventListener('input', () => {
                    // Validar rango
                    if(input.value > 100) input.value = 100;
                    if(input.value < 0) input.value = 0;
                    
                    // Actualizar total
                    updateTotal();
                });
                input._percentageListenerAdded = true; // Marcar como procesado
            }
        });
        
        // Actualizar al cargar y después de cambios
        updateTotal();
    }
    // Función de validación común
    function addPercentageValidation() {
        const validatePercentages = () => {
            const allPercentages = document.querySelectorAll('[class*="porcentaje-input"]');
            let total = 0;
            
            allPercentages.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });

            if (total > 100) {
                Swal.fire('Error', 'La suma de los porcentajes no puede exceder el 100%', 'error');
                return false;
            }
            return true;
        };

        // Validar en tiempo real
        document.querySelectorAll('[class*="porcentaje-input"]').forEach(input => {
            input.addEventListener('input', validatePercentages);
        });

        // Validar antes de enviar el formulario
        document.querySelector('form').addEventListener('submit', function(e) {
            if (!validatePercentages()) {
                e.preventDefault();
            }
        });
    }

    // Eliminar elementos (común para ambos)
    document.querySelectorAll('[id^="subgrupos-container"]').forEach(container => {
        container.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn-remove-subgrupo')) {
                e.target.parentElement.remove();
                const containerId = e.target.closest('[id^="subgrupos-container"]').id;
                if (containerId.includes('2')) {
                    subgrupoCount2--;
                } else {
                    subgrupoCount--;
                }
                addPercentageValidation();
            }
        });
    });

    // Ejecutar validación inicial
    addPercentageValidation();

    // Lógica para agregar participantes (corregida)
    document.getElementById('btn-add-participante')?.addEventListener('click', function() {
        const container = document.getElementById('participantes-container');
        if(!container) return;

        const newParticipante = document.createElement('div');
        newParticipante.className = 'participante-item';
        newParticipante.innerHTML = `
            <span class="remove-participante"><i class="fas fa-times-circle"></i></span>
            <div class="row">
                <div class="col-md-5 mb-3">
                    <label class="form-label required-field">Nombre Participante</label>
                    <input type="text" class="form-control" 
                           name="participantes[${participanteCount}][nombre]" 
                           required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label required-field">Rol</label>
                    <select class="form-select" name="participantes[${participanteCount}][rol]" required>
                        <option value="">Seleccione un rol</option>
                        <option>Arquitecto</option>
                        <option>Gerente</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label required-field">Participación</label>
                    <div class="input-group">
                        <input type="number" class="form-control" 
                               name="participantes[${participanteCount}][participacion]" 
                               required>
                        <span class="input-group-text">%</span>
                    </div>
                </div>
            </div>
        `;

        container.appendChild(newParticipante);
        
        // Eliminar participante
        newParticipante.querySelector('.remove-participante')?.addEventListener('click', () => {
            newParticipante.remove();
        });
        
        participanteCount++;
    });

    function cargarCondiciones(condicionesArray) {
        const container = document.getElementById('lista-condiciones');
        container.innerHTML = '';

        condicionesArray.forEach(cond => {
            // Convertir strings antiguos a objetos
            if (typeof cond === 'string') {
                const [texto, estado] = cond.split(' - OK');
                cond = {
                    texto: texto.trim(),
                    aprobado: estado !== undefined,
                    fecha: estado?.match(/\((.*)\)/)?.[1] || ''
                };
            }

            const div = document.createElement('div');
            div.className = 'form-check mb-2';
            div.innerHTML = `
                <input type="checkbox" 
                    class="form-check-input"
                    ${cond.aprobado ? 'checked' : ''}
                    ${cond.fecha ? `data-fecha="${cond.fecha}"` : ''}>
                <label class="form-check-label">${cond.texto}</label>
            `;

            // Agregar evento al checkbox cargado
            div.querySelector('input').addEventListener('change', function() {
                if(this.checked) {
                    this.setAttribute('data-fecha', getFechaBogotaSinZona());
                } else {
                    this.removeAttribute('data-fecha');
                }
            });

            container.appendChild(div);
        });
    }
    
    // ————————————————————————————————————————————————
    // Helpers y constantes compartidas
    // ————————————————————————————————————————————————

    /** Campos internos y sus cabeceras para Excel */
    const KEYS = [
        'id_proyecto','fecha_creacion',
        'tipo_producto','rango_proyecto','grupo_de_riesgo', 'Subgrupo1', 
        'Subgrupo2', 'Subgrupo3' , 'nit_grupo_riesgo',
        'nit_titular','titular_credito','nombre_proyecto','tipo_inmuebles',
        'segmento','ciudad','tipo_fiducia','fiduciaria','gerente','arquitecto',
        'auxiliar','perito','monto_solicitado_1_desembolso','monto_solicitado_cpi',
        'monto_solicitado_lote','total_valor_aprobado','calificacion_it',
        'costos_financiables','valor_lote','valor_total_proyecto',
        'meses_programacion','total_inmuebles','meses_para_venta'
    ];
    const HEADERS = [
        'ID Proyecto','Fecha Creación',
        'Tipo Producto','Rango Proyecto','Grupo de Riesgo', 'Subgrupo1', 
        'Subgrupo2', 'Subgrupo3' , 'NIT Grupo Riesgo',
        'NIT Titular','Titular Crédito','Nombre Proyecto','Tipo Inmuebles',
        'Segmento','Ciudad','Tipo Fiducia','Fiduciaria','Gerente','Arquitecto',
        'Auxiliar','Perito','Monto 1er Desembolso','Monto CPI','Monto Lote',
        'Total Valor Aprobado','Calificación IT','Costos Financiables','Valor Lote',
        'Valor Total Proyecto','Meses Programación','Total Inmuebles','Meses Venta'
    ];

    /** Elimina todo excepto dígitos, punto y signo, y parsea a número */
    function cleanNumber(raw) {
        if (raw == null || raw === '') return 0;
        if (typeof raw === 'number') return raw;
        const cleaned = raw.toString().replace(/[^0-9.\-]/g, '');
        const num = parseFloat(cleaned);
        return isNaN(num) ? 0 : num;
    }
    /** Genera y guarda un Excel con todos los proyectos en el servidor */
    function generarExcel(proyectos, usuario) {
        const KEYS = [
            'id_proyecto', 'fecha_creacion', 'tipo_producto', 'rango_proyecto',
            'grupoPrincipal', 'subgrupo_1', 'subgrupo_2', 'subgrupo_3', 
            'nit_grupo_riesgo', 'nit_titular', 'titular_credito',
            'nombre_proyecto', 'tipo_inmuebles', 'segmento', 'ciudad', 'tipo_fiducia',
            'fiduciaria', 'gerente', 'arquitecto', 'auxiliar', 'perito',
            'monto_solicitado_1_desembolso', 'monto_solicitado_cpi',
            'monto_solicitado_lote', 'total_valor_aprobado', 'calificacion_it',
            'costos_financiables', 'valor_lote', 'valor_total_proyecto',
            'meses_programacion', 'total_inmuebles', 'meses_para_venta',
            // Nuevos campos de aprobaciones GOSO
            'tipo_credito', 'departamento', 'caso_pcp_bizagi', 'visitas_a_cobrar',
            'cobrar_estudio_tecnico', 'fecha_aprobacion', 'alerta_fecha_aprobacion',
            'vigencia_en_meses', 'instancia_aprobacion', 'condiciones_aprobacion',
            'porcentaje_solicitado_financiables'
        ];

        const numericFields = [
            'monto_solicitado_1_desembolso', 'monto_solicitado_cpi',
            'monto_solicitado_lote', 'total_valor_aprobado', 'valor_lote',
            'valor_total_proyecto', 'meses_programacion', 'total_inmuebles',
            'meses_para_venta', 'visitas_a_cobrar', 'vigencia_en_meses',
            'porcentaje_solicitado_financiables'
        ];

        const proyectosLimpios = proyectos.map(p => {
            let proyecto = {};
            KEYS.forEach(key => {
                if (key === 'condiciones_aprobacion') {
                    // Convertir a texto separado por comas
                    proyecto[key] = Array.isArray(p[key]) 
                        ? p[key].join(', ') 
                        : p[key] || 'Sin condiciones';
                } else {
                    proyecto[key] = numericFields.includes(key) 
                        ? cleanNumber(p[key]) 
                        : p[key] || '';
                }
            });
            return proyecto;
        });

        fetch('/exportar_excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ proyectos: proyectosLimpios })
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => Promise.reject(err));
            }
            return response.json();
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire({
                title: 'Error',
                text: error.message || 'Error al comunicarse con el servidor',
                icon: 'error',
                confirmButtonText: 'Aceptar'
            });
        });
    }


    /** Lee el valor de un <select> */
    function getSelectValue(selectEl) {
    return selectEl.options[selectEl.selectedIndex]?.value || '';
    }

    function getValue(sheet, cell) {
        const c = sheet[cell];
        if (!c) return null;
        // 1) Si tiene v definido, devuélvelo (valor almacenado o calculado)
        if (c.v !== undefined && c.v !== null) return c.v;
        // 2) Si es fórmula pero v es nulo, usa el texto formateado w
        if (c.f && c.w !== undefined) {
            const num = parseFloat(c.w.toString().replace(/[^0-9.\-]/g, ''));
            return isNaN(num) ? c.w : num;
        }
        // 3) Si nada de lo anterior, null
        return null;
    }

    // ————————————————————————————————————————————————
    // 2) FUNCIÓN PARA CARGAR SELECTOR DE PROYECTOS
    // ————————————————————————————————————————————————
    function cargarProyectosEnSelector() {
        const selector = document.getElementById('seleccionar-proyecto');
        selector.innerHTML = '<option value="">Seleccione un proyecto...</option>';
        const proyectos = JSON.parse(localStorage.getItem('proyectos')) || [];

        proyectos.forEach(proyecto => {
            const option = document.createElement('option');
            option.value = proyecto.id_proyecto;
            option.textContent = `${proyecto.id_proyecto} - ${proyecto.nombre_proyecto || 'Sin nombre'}`;
            selector.appendChild(option);
        });
    }

    // 3) MANEJAR SELECCIÓN DE PROYECTO (HABILITAR Y CARGAR DATOS COMPLETOS)
    document.getElementById('seleccionar-proyecto').addEventListener('change', function(e) {
        const idProyecto = e.target.value;
        const proyectos = JSON.parse(localStorage.getItem('proyectos') || '[]');
        const proyecto = proyectos.find(p => p.id_proyecto === idProyecto);
        const departamento = (proyecto.departamento || '').toLowerCase();
        const municipio = (proyecto.ciudad || '').toLowerCase();
        const idSeleccionado = this.value;
        localStorage.setItem('idProyectoSeleccionado', idSeleccionado);

        // Actualizar campos
        document.querySelector('[name="departamento"]').value = departamento;
        document.querySelector('[name="municipio"]').value = municipio;

        // 1. Habilitar sección 4
        const isAuxiliar = session.usuario.rol === 'auxiliar';
        const section4Fields = document.querySelectorAll('#form-seccion4 input, #form-seccion4 select');
        
        if (idProyecto) {
            section4Fields.forEach(field => {
                field.disabled = isAuxiliar ? false : true;
                if (!isAuxiliar) field.disabled = false; // Admin/arquitecto edita todo
            });
        }

        // 2. Cargar todos los campos
        if (proyecto) {
            // Mapeo completo de campos

            // Cargar participantes
            // if (proyecto.participantes) {
            //     cargarParticipantes(proyecto.participantes);
            // }
            
            // Cargar condiciones (HABILITAR ESTA SECCIÓN)
            if (proyecto.condiciones_aprobacion) {
                cargarCondiciones(proyecto.condiciones_aprobacion);
                
                const checkboxes = document.querySelectorAll('#lista-condiciones input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        // Bloquear y mantener fecha existente
                        checkbox.disabled = true;
                        
                        // Si no tiene fecha, asignar la actual (para migraciones o datos antiguos)
                        if (!checkbox.dataset.fecha) {
                            checkbox.setAttribute('data-fecha', getFechaBogotaSinZona());
                        }
                    }
                });

                // Validar estado del botón según rol
                if (session.usuario.rol === 'arquitecto') {
                    // Arquitecto: Todas deben estar aprobadas
                    const todasAprobadas = Array.from(checkboxes).every(cb => cb.checked);
                    document.getElementById('btn-siguiente-paso').disabled = !todasAprobadas;
                } else {
                    // Otros roles: Al menos una aprobada
                    const algunaAprobada = Array.from(checkboxes).some(cb => cb.checked);
                    document.getElementById('btn-siguiente-paso').disabled = !algunaAprobada;
                }
            }

            document.querySelector('[name="municipio"]').value = proyecto.ciudad || '';


            const mapCampos = {
                // Sección 1: Datos Básicos
                'id_proyecto': proyecto.id_proyecto,
                'tipo_producto': proyecto.tipo_producto,
                'rango_proyecto': proyecto.rango_proyecto,
                'grupo_riesgo': proyecto.grupoPrincipal,
                'nit_grupo_riesgo': proyecto.nit_grupo_riesgo,
                'nit_titular': proyecto.nit_titular,
                'titular_credito': proyecto.titular_credito,
                'nombre_proyecto': proyecto.nombre_proyecto,
                'tipo_proyecto': proyecto.tipo_inmuebles,
                'segmento': proyecto.segmento,
                'municipio': proyecto.ciudad,
                'tipodefiducia': proyecto.tipo_fiducia,
                'fiduciaria': proyecto.fiduciaria,
                
                // Sección 2: Equipo
                'gerente': proyecto.gerente,
                'arquitecto': proyecto.arquitecto,
                'auxiliar': proyecto.auxiliar,
                'perito': proyecto.perito,
                
                // Sección 3: Montos
                'monto_desembolso': proyecto.monto_solicitado_1_desembolso,
                'monto_cpi': proyecto.monto_solicitado_cpi,
                'monto_lote': proyecto.monto_solicitado_lote,
                'total_aprobado': proyecto.total_valor_aprobado,
                
                'calificacion_it': proyecto.calificacion_it,
                'costos_financiables': proyecto.costos_financiables,
                'valor_lote': proyecto.valor_lote,
                'valor_total_proyecto': proyecto.valor_total_proyecto,
                'meses_programacion': proyecto.meses_programacion,
                'total_inmuebles': proyecto.total_inmuebles,
                'meses_venta': proyecto.meses_para_venta,
                
                // Sección 4: Aprobaciones GOSO
                'tipo_credito': proyecto.tipo_credito,
                'alerta_fecha_aprobacion' : proyecto.alerta_fecha_aprobacion,
                'departamento': proyecto.departamento,
                'caso_pcp_bizagi': proyecto.caso_pcp_bizagi,
                'visitas_a_cobrar': proyecto.visitas_a_cobrar,
                'cobrar_estudio_tecnico': proyecto.cobrar_estudio_tecnico,
                'fecha_aprobacion': proyecto.fecha_aprobacion,
                'vigencia_en_meses': proyecto.vigencia_en_meses,
                'instancia_aprobacion': proyecto.instancia_aprobacion,
                'porcentaje_solicitado_financiables': proyecto.porcentaje_solicitado_financiables,
                
                // Sección 5: Legal/Técnico
                'validacion_licencia': proyecto.validacion_licencia_construccion,
                'fecha_radicacion_licencia': proyecto.fecha_radicacion_licencia,
                'requiere_poliza_decenal': proyecto.requiere_poliza_decenal,

                // Subgrupos
                'subgrupo_1': proyecto.subgrupo_1,
                'subgrupo_2': proyecto.subgrupo_2,
                'subgrupo_3': proyecto.subgrupo_3,
                'porcentaje_1': proyecto.porcentaje_1,
                'porcentaje_2': proyecto.porcentaje_2,
                'porcentaje_3': proyecto.porcentaje_3
            };

            // Cargar campos normales
            Object.entries(mapCampos).forEach(([key, value]) => {
                const element = document.querySelector(`[name="${key}"]`);
                if (element) {
                    element.value = value || '';
                    if (element._choicesInstance) {
                        element._choicesInstance.setChoiceByValue(value);
                    }
                }
            });
             

            //3. Cargar subgrupos dinámicos"
            const subgruposContainer = document.getElementById('subgrupos-container');
            subgruposContainer.innerHTML = '';

            // Cargar subgrupos y porcentajes almacenados
            const subgruposData = [
                { nombre: proyecto.subgrupo_1, porcentaje: proyecto.porcentaje_1 },
                { nombre: proyecto.subgrupo_2, porcentaje: proyecto.porcentaje_2 },
                { nombre: proyecto.subgrupo_3, porcentaje: proyecto.porcentaje_3 }
            ].filter(item => item.nombre);

            subgruposData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'input-group mb-2';
                div.innerHTML = `
                    <input list="grupo_de_riesgo-list" 
                        class="form-control subgrupo-input" 
                        name="subgrupos[]" 
                        value="${item.nombre}"
                        placeholder="Subgrupo ${index + 1}">
                    <input type="number" 
                        class="form-control porcentaje-input" 
                        name="porcentajes[]" 
                        value="${item.porcentaje || ''}"
                        placeholder="%" 
                        step="0.01" 
                        min="0" 
                        max="100" 
                        style="max-width: 100px;">
                    ${index === 0 ? 
                        '<button type="button" class="btn btn-success btn-add-subgrupo">+</button>' : 
                        '<button type="button" class="btn btn-danger btn-remove-subgrupo">-</button>'}
                `;
                subgruposContainer.appendChild(div);
            });

            // 4. Actualizar componentes visuales
            setTimeout(() => {
            // 1. Cálculos iniciales
                    calcularTotalAprobado();
                    calcularPorcentajeFinanciables();

                    // 2. Actualizar selects específicos 
                    ['departamento', 'municipio'].forEach(name => {
                        const select = document.querySelector(`[name="${name}"]`);
                        if (select && select._choicesInstance) {
                            select._choicesInstance.setChoiceByValue(select.value);
                        }
                    });

                    // 3. Actualizar Choices.js solo para selects con datos dinámicos
                    const selectsDinamicos = document.querySelectorAll('.choices-selector'); // Usa una clase específica
                    selectsDinamicos.forEach(select => {
                        if (select._choicesInstance) {
                            select._choicesInstance.setChoiceByValue(select.value);
                        }
                    });
                }, 150); // Aumentar tiempo para asegurar que el DOM esté listo
               }
            });

    document.getElementById('seleccionar-proyecto').addEventListener('change', calcularPorcentajeFinanciables);

    // ————————————————————————————————————————————————
    // 4) MANEJAR ENVÍO DE SECCIÓN 4 (ACTUALIZACIÓN COMPLETA)
    // ————————————————————————————————————————————————
    document.getElementById('form-seccion4').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const idProyecto = document.getElementById('seleccionar-proyecto').value;
        const proyectos = JSON.parse(localStorage.getItem('proyectos') || '[]');
        const proyectoIndex = proyectos.findIndex(p => p.id_proyecto === idProyecto);
        const departamento = departamentoSelect.options[departamentoSelect.selectedIndex]?.text || '';
        const ciudad = municipioSelect.options[municipioSelect.selectedIndex]?.text || '';
        const fechaBogota = new Date().toLocaleString('es-CO', getFechaBogotaSinZona());

        
        if (!idProyecto) {
            Swal.fire('Error', 'Debe seleccionar un proyecto para continuar y guardar', 'error');
            return;
        }

          // Obtener porcentajes y validar
            const porcentajes = Array.from(document.querySelectorAll('.porcentaje-input'))
                .map(input => parseFloat(input.value) || 0);
            
            // Función de validación de porcentajes
            function validarPorcentajes(porcentajes) {
                const total = porcentajes.reduce((acc, curr) => acc + (curr || 0), 0);
                return total <= 100;
            }
            

        
        if (proyectoIndex === -1) return;

        // Recoger subgrupos actualizados
        const subgrupos = Array.from(document.querySelectorAll('.subgrupo-input'))
                            .map(input => input.value.trim())
                            .filter(Boolean);

        // Actualizar proyecto
        const proyectoActualizado = {
            ...proyectos[proyectoIndex],
            // Campos editables
            monto_solicitado_1_desembolso: parseFloat(this.monto_desembolso.value) || 0,
            monto_solicitado_cpi: parseFloat(this.monto_cpi.value) || 0,
            monto_solicitado_lote: parseFloat(this.monto_lote.value) || 0,
            subgrupo_1: subgrupos[0] || '',
            subgrupo_2: subgrupos[1] || '',
            subgrupo_3: subgrupos[2] || '',
            porcentaje_1: porcentajes[0] || 0,
            porcentaje_2: porcentajes[1] || 0,
            porcentaje_3: porcentajes[2] || 0,
            // Sección 4
            tipo_credito: this.tipo_credito.value,
            departamento,
            ciudad,
            caso_pcp_bizagi: this.caso_pcp_bizagi.value,
            visitas_a_cobrar: parseFloat(this.visitas_a_cobrar.value) || 0,
            cobrar_estudio_tecnico: this.cobrar_estudio_tecnico.value,
            fecha_aprobacion: this.fecha_aprobacion.value,
            vigencia_en_meses: parseFloat(this.vigencia_en_meses.value) || 0,
            instancia_aprobacion: this.instancia_aprobacion.value,
            condiciones_aprobacion: Array.from(this.querySelectorAll('#lista-condiciones .form-check')).map(div => {
                const checkbox = div.querySelector('input');
                const texto = div.querySelector('label').textContent.trim(); // Texto real del label
                return checkbox.checked ? `${texto} - OK - ${fechaBogota}` : `${texto} - ${fechaBogota}`;
            }),
            porcentaje_solicitado_financiables: calcularPorcentajeFinanciables(),
            alerta_fecha_aprobacion: new Date().getFechaBogotaSinZona()
        };

        proyectos[proyectoIndex] = proyectoActualizado;
        localStorage.setItem('proyectos', JSON.stringify(proyectos));
        
        generarExcel([proyectoActualizado]);
        Swal.fire('Éxito', 'Proyecto actualizado correctamente', 'success');
    });

    // Modificar la función de carga de proyectos
    function cargarParticipantes(participantes) {
        const container = document.getElementById('participantes-container');
        container.innerHTML = '';
        
        participantes.forEach((participante, index) => {
            const newParticipante = document.createElement('div');
            newParticipante.className = 'participante-item';
            newParticipante.innerHTML = `
                <span class="remove-participante"><i class="fas fa-times-circle"></i></span>
                <div class="row">
                    <div class="col-md-5 mb-3">
                        <input type="text" class="form-control" 
                            name="participantes[${index}][nombre]" 
                            value="${participante.nombre}" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <select class="form-select" name="participantes[${index}][rol]" required>
                            <option value="">Seleccione un rol</option>
                            <option ${participante.rol === 'Arquitecto' ? 'selected' : ''}>Arquitecto</option>
                            <option ${participante.rol === 'Gerente' ? 'selected' : ''}>Gerente</option>
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="input-group">
                            <input type="number" class="form-control" 
                                name="participantes[${index}][participacion]" 
                                value="${participante.participacion}" required>
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(newParticipante);
        });
        participanteCount = participantes.length;
    }
    // ————————————————————————————————————————————————
    // 1) Handler: Crear proyecto manual (+ exportar Excel)
    // ————————————————————————————————————————————————
    document.getElementById('form-crear-proyecto')?.addEventListener('submit', function(e) {
    e.preventDefault();
        if (typeof validarCampos === 'function' && !validarCampos()) return;

        // Recoger participantes dinámicos
        const participantes = Array.from(
            document.querySelectorAll('.participante-item')
        ).map((item, i) => ({
            nombre:        item.querySelector(`[name="participantes[${i}][nombre]"]`).value.trim(),
            rol:           item.querySelector(`[name="participantes[${i}][rol]"]`).value,
            participacion: parseFloat(item.querySelector(`[name="participantes[${i}][participacion]"]`).value) || 0
        }));

        // Helper genérico para leer inputs/selects
        const getVal = (sel, type = 'string') => {
            const el = document.querySelector(sel);
            if (!el) return type === 'number' ? 0 : '';
            const v = el.tagName === 'SELECT' ? getSelectValue(el) : el.value.trim();
            if (type === 'number') return parseFloat(v) || 0;
            return v;
        };

        const grupoPrincipal = getVal('[name="grupo_riesgo"]');
        const subgrupos = Array.from(document.querySelectorAll('.subgrupo-input'))
                     .map(input => input.value.trim())
                     .filter(value => value !== '');

        // Obtener porcentajes y validar
        const porcentajes = Array.from(document.querySelectorAll('.porcentaje-input'))
                .map(input => parseFloat(input.value) || 0);
            
        // Función de validación de porcentajes
        function validarPorcentajes(porcentajes) {
                const total = porcentajes.reduce((acc, curr) => acc + (curr || 0), 0);
                return total <= 100;
            }
       

        // Validación
        if (!grupoPrincipal || subgrupos.length === 0) {
            Swal.fire('Error', 'Debe seleccionar al menos el grupo principal y un subgrupo', 'error');
            return;
        }             

        // Construir el objeto con mismas claves que importador
        const proyecto = {
            // Sección 1: Datos Básicos
            id_proyecto: getVal('[name="id_proyecto"]'),
            fecha_creacion: getFechaBogotaSinZona(),
            tipo_producto: getVal('[name="tipo_producto"]'),
            rango_proyecto: getVal('[name="tipo_producto"]'),
            grupoPrincipal: grupoPrincipal,
            subgrupo_1: subgrupos[0] || '',
            subgrupo_2: subgrupos[1] || '',
            subgrupo_3: subgrupos[2] || '',
            porcentaje_1 : porcentajes[0] || '',
            porcentaje_2 : porcentajes[1] || '',
            porcentaje_3 : porcentajes[2] || '',
            nit_grupo_riesgo: getVal('[name="nit_grupo_riesgo"]'),
            nit_titular: getVal('[name="nit_titular"]'),
            titular_credito: getVal('[name="titular_credito"]'),
            nombre_proyecto: getVal('[name="nombre_proyecto"]'),
            tipo_inmuebles: getVal('[name="tipo_proyecto"]'),
            segmento: getVal('[name="segmento"]'),
            ciudad: getSelectText('[name="municipio"]'),
            tipo_fiducia: getVal('[name="tipodefiducia"]'),
            fiduciaria: getVal('[name="fiduciaria"]'),
            
            // Sección 2: Equipo
            gerente: getVal('[name="gerente"]'),
            arquitecto: getVal('[name="arquitecto"]'),
            auxiliar: getVal('[name="auxiliar"]'),
            perito: getVal('[name="perito"]'),
            
            // Sección 3: Montos
            monto_solicitado_1_desembolso: getVal('[name="monto_desembolso"]', 'number'),
            monto_solicitado_cpi: getVal('[name="monto_cpi"]', 'number'),
            monto_solicitado_lote: getVal('[name="monto_lote"]', 'number'),
            total_valor_aprobado: getVal('[name="total_aprobado"]', 'number'),
            calificacion_it: getVal('[name="calificacion_it"]', 'number'),
            costos_financiables: getVal('[name="costos_financiables"]', 'number'),
            valor_lote: getVal('[name="valor_lote"]', 'number'),
            valor_total_proyecto: getVal('[name="valor_total_proyecto"]', 'number'),
            meses_programacion: getVal('[name="meses_programacion"]', 'number'),
            total_inmuebles: getVal('[name="total_inmuebles"]', 'number'),
            meses_para_venta: 12,
            
            // Sección 4: Aprobaciones GOSO
            tipo_credito: getVal('[name="tipo_credito"]'),
            departamento: getSelectText('[name="departamento"]'),
            caso_pcp_bizagi: getVal('[name="caso_pcp_bizagi"]'),
            visitas_a_cobrar: getVal('[name="visitas_a_cobrar"]', 'number'),
            cobrar_estudio_tecnico: getVal('[name="cobrar_estudio_tecnico"]'),
            fecha_aprobacion: getVal('[name="fecha_aprobacion"]'),
            alerta_fecha_aprobacion: null, // Se calcula automáticamente
            vigencia_en_meses: getVal('[name="vigencia_en_meses"]', 'number'),
            instancia_aprobacion: getVal('[name="instancia_aprobacion"]'),
            condiciones_aprobacion: obtenerCondicionesAprobacion(),
            porcentaje_solicitado_financiables: calcularPorcentajeFinanciables(),
            
            // Sección 5: Legal/Técnico
            validacion_licencia_construccion: getVal('[name="validacion_licencia"]'),
            fecha_radicacion_licencia: getVal('[name="fecha_radicacion_licencia"]'),
            requiere_poliza_decenal: getVal('[name="requiere_poliza_decenal"]'),
            participantes,
            estado:                         'Activo',
            avance:                         0,
            ultimo_desembolso:              null
        };

       

        // Guardar en LocalStorage
        const all = JSON.parse(localStorage.getItem('proyectos') || '[]');
        const existingIndex = all.findIndex(p => p.id_proyecto === proyecto.id_proyecto);

        if (existingIndex !== -1) {
            // Mantener fecha de creación original
            const fechaCreacionOriginal = all[existingIndex].fecha_creacion;
            
            // Actualizar solo campos permitidos
            all[existingIndex] = { 
                ...all[existingIndex],
                ...proyecto,
                fecha_creacion: fechaCreacionOriginal, // Conservar fecha original
                alerta_fecha_aprobacion: getFechaBogotaSinZona(), // Actualizar fecha de modificación
                condiciones_aprobacion: proyecto.condiciones_aprobacion || all[existingIndex].condiciones_aprobacion,
                porcentaje_solicitado_financiables: proyecto.porcentaje_solicitado_financiables || all[existingIndex].porcentaje_solicitado_financiables
            };
            
            Swal.fire('Actualizado', 'Proyecto actualizado exitosamente', 'success');
        } else {
            // Es nuevo proyecto, agregar normalmente
            all.push(proyecto);
            Swal.fire('Creado', 'Nuevo proyecto creado', 'success');
        }


       
        localStorage.setItem('proyectos', JSON.stringify(all));

        // Refrescar tabla y exportar Excel
        if (typeof cargarProyectos === 'function') cargarProyectos({});
        generarExcel(all);

        // Limpiar y feedback
        if (typeof limpiarFormulario === 'function') limpiarFormulario();
        new bootstrap.Modal(document.getElementById('successModal')).show();
        });

        // ————————————————————————————————————————————————
        // 2) Handler: Importar desde Excel (+ exportar Excel)
        // ————————————————————————————————————————————————
        document.getElementById('btn-confirm-import').addEventListener('click', function() {
            // 1. Obtener elementos
            const modal = document.getElementById('importModal');
            const grupoRiesgo = document.getElementById('grupo_riesgoInput2');
            const auxiliar = modal.querySelector('[name="auxiliar"]');
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];
            
            // 2. Obtener valores de subgrupos y grupo principal - CORREGIDO
            const subgrupos = Array.from(document.querySelectorAll('.subgrupo-input2'))
                                .map(input => input.value.trim())
                                .filter(value => value !== '');
            
            const grupoPrincipal = grupoRiesgo.value; // Usar el mismo elemento validado

            // Obtener porcentajes y validar
            const porcentajes = Array.from(document.querySelectorAll('.porcentaje-input2'))
                .map(input => parseFloat(input.value) || 0);
            
            // Función de validación de porcentajes
            function validarPorcentajes(porcentajes) {
                const total = porcentajes.reduce((acc, curr) => acc + (curr || 0), 0);
                return total <= 100;
            }

            

            // 3. Validación mejorada
            let isValid = true;
            [grupoRiesgo, auxiliar, fileInput].forEach(el => {
                el.classList.remove('is-invalid');
                if (el === fileInput && !file) {
                    el.classList.add('is-invalid');
                    isValid = false;
                }
            });

            if (!grupoPrincipal) {
                grupoRiesgo.classList.add('is-invalid');
                isValid = false;
            }
            if (!auxiliar.value) {
                auxiliar.classList.add('is-invalid');
                isValid = false;
            }
            if (subgrupos.length === 0) {
                document.querySelectorAll('.subgrupo-input2').forEach(input => {
                    input.classList.add('is-invalid');
                });
                isValid = false;
            }

            if (!isValid) {
                Swal.fire('Error', 'Verifique los campos marcados en rojo', 'error');
                return;
            }

            // 4. Función getVal mejorada
            const getVal = selector => {
                const el = modal.querySelector(selector);
                return el ? el.value.trim() : '';
            };

            // 4. Si todo es válido, leer el archivo
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                // Leer y parsear XLSX
                const dataArr = new Uint8Array(e.target.result);
                const wbImport = XLSX.read(dataArr, { type: 'array' });
                

                // Helper para hoja por nombre
                const getSheet = name =>
                    wbImport.Sheets[
                    Object.keys(wbImport.Sheets)
                            .find(n => n.trim().toUpperCase() === name.toUpperCase())
                    ];
                const sheetBase    = getSheet('BASE');
                const sheetInforme = getSheet('INFORME');
                if (!sheetBase || !sheetInforme) {
                    throw new Error('Faltan hojas BASE o INFORME');
                }

                // Leer celda
                const getValue = (sheet, cell) => {
                    const value = sheet[cell]?.v;
                    return (typeof value === 'number') ? Math.trunc(value) : value;
                };

                const costosFinanciables = parseInt(getValue(sheetInforme, 'K17'), 10) || 0;
                const valorTotalProyecto = parseInt(getValue(sheetInforme, 'E25'), 10) || 0;

                // Mapeo de celdas
                const campos = {
                    id_proyecto:                   { hoja: sheetBase,    cell: 'N6',  type: 'string', default: '' },
                    fecha_creacion:                { hoja: null,  cell: null, type: 'string', default: getFechaBogotaSinZona(), },
                    tipo_producto:                 { hoja: sheetBase,    cell: 'Q19', type: 'string', default: '' },
                    rango_proyecto:                { hoja: sheetBase,    cell: 'AH25',type: 'string', default: '' },
                    grupoPrincipal:                { hoja: null, cell: null, type: 'string', default: grupoPrincipal },
                    subgrupo_1:                    { hoja: null, cell: null, type: 'string', default: subgrupos[0] || '' },
                    subgrupo_2:                    { hoja: null, cell: null, type: 'string', default: subgrupos[1] || '' },
                    subgrupo_3:                    { hoja: null, cell: null, type: 'string', default: subgrupos[2] || '' },
                    porcentaje_1:                  { hoja: null, cell: null, type: 'string', default: porcentajes[0] || '' },
                    porcentaje_2:                  { hoja: null, cell: null, type: 'string', default: porcentajes[1] || '' },
                    porcentaje_3:                  { hoja: null, cell: null, type: 'string', default: porcentajes[2] || '' },
                                                   
                    nit_grupo_riesgo:              { hoja: sheetBase,    cell: 'AF15',type: 'string', default: '' },
                    nit_titular:                   { hoja: sheetBase,    cell: 'AF14',type: 'string', default: '' },
                    titular_credito:               { hoja: sheetBase,    cell: 'N14', type: 'string', default: '' },
                    nombre_proyecto:               { hoja: sheetBase,    cell: 'O24', type: 'string', default: '' },
                    tipo_inmuebles:                { hoja: sheetBase,    cell: 'AH28',type: 'string', default: '' },
                    segmento:                      { hoja: sheetBase,    cell: 'Y15', type: 'string', default: '' },
                    ciudad:                        { hoja: sheetBase,    cell: 'Y26', type: 'string', default: '' },
                    tipo_fiducia:                  { hoja: sheetBase,    cell: 'Y40', type: 'string', default: '' },
                    fiduciaria:                    { hoja: sheetBase,    cell: 'AE40',type: 'string', default: '' },
                    gerente:                       { hoja: sheetBase,    cell: 'X5',  type: 'string', default: '' },
                    arquitecto:                    { hoja: sheetBase,    cell: 'AC10',type: 'string', default: '' },
                    auxiliar:                      { 
                                                        hoja: null,  
                                                        cell: null,
                                                        type: 'string', 
                                                        default: () => getVal('[name="auxiliar"]') 
                                                    },
                    perito:                        { hoja: sheetBase,    cell: 'N8',  type: 'string', default: '' },
                    monto_solicitado_1_desembolso: { hoja: sheetBase,    cell: 'G20', type: 'number', default: 0 },
                    monto_solicitado_cpi:          { hoja: sheetBase,    cell: 'Q20', type: 'number', default: 0 },
                    monto_solicitado_lote:         { hoja: sheetBase,    cell: 'V20', type: 'number', default: 0 },
                    total_valor_aprobado:          { hoja: sheetBase,    cell: 'AA20',type: 'number', default: 0 },
                    valor_lote:                    { hoja: sheetBase,    cell: 'V28', type: 'number', default: 0 },
                    meses_programacion:            { hoja: sheetBase,    cell: 'AC28',type: 'number', default: 0 },
                    total_inmuebles:               { hoja: sheetBase,    cell: 'N99', type: 'number', default: 0 },
                    // Calificacion IT viene de la fórmula en O99 de INFORME
                    calificacion_it:               { hoja: sheetInforme, cell: 'O99', type: 'number', default: 0 },
                    // Costos Financiables viene de la fórmula en K17 de INFORME
                    costos_financiables: { 
                        hoja: sheetInforme, 
                        cell: 'K17', 
                        type: 'number', 
                        default: 0 
                    },
                    valor_total_proyecto: { 
                        hoja: sheetInforme, 
                        cell: 'E25', 
                        type: 'number', 
                        default: 0 
                    },

                    meses_para_venta:              { hoja: null,          cell: null,  type: 'number', default: 12 },
                    // Sección 4: Aprobaciones GOSO (nuevos campos)
                    tipo_credito: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: getVal('[name="tipo_credito"]') || '' 
                    },
                    departamento: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: getSelectText('[name="departamento"]') || '' 
                    },
                    caso_pcp_bizagi: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: '' 
                    },
                    visitas_a_cobrar: { 
                        hoja: null, 
                        cell: null, 
                        type: 'number', 
                        default: 0 
                    },
                    cobrar_estudio_tecnico: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: '' 
                    },
                    fecha_aprobacion: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: '' 
                    },
                    alerta_fecha_aprobacion: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: null 
                    },
                    vigencia_en_meses: { 
                        hoja: null, 
                        cell: null, 
                        type: 'number', 
                        default: 0 
                    },
                    instancia_aprobacion: { 
                        hoja: null, 
                        cell: null, 
                        type: 'string', 
                        default: '' 
                    },
                    condiciones_aprobacion: { 
                        hoja: null, 
                        cell: null, 
                        type: 'array', 
                        default: [] 
                    },
                    porcentaje_solicitado_financiables: { 
                        hoja: null, 
                        cell: null, 
                        type: 'number', 
                        default: 0 
                    }
                    
                };

            
                // Construcción del objeto proyecto
                const proyecto = {};
                Object.entries(campos).forEach(([key, cfg]) => {
                let value;
                
                if (cfg.hoja) {
                    // Valor del Excel
                    const raw = getValue(cfg.hoja, cfg.cell);
                    value = (cfg.type === 'number') ? cleanNumber(raw) : raw?.toString().trim();
                } else {
                    // Valor del formulario (ejecuta la función default)
                    value = typeof cfg.default === 'function' ? cfg.default() : cfg.default;
                }
                
                proyecto[key] = value || cfg.default; // Asigna el valor obtenido
            });


                // Validar y guardar
                if (!proyecto.id_proyecto) {
                    throw new Error('ID_PROYECTO no encontrado en N6 de BASE');
                }
                const existentes = JSON.parse(localStorage.getItem('proyectos') || '[]');
                if (existentes.some(p => p.id_proyecto.toUpperCase() === proyecto.id_proyecto.toUpperCase())) {
                    throw new Error(`El proyecto ${proyecto.id_proyecto} ya está registrado`);
                }
                existentes.push(proyecto);
                localStorage.setItem('proyectos', JSON.stringify(existentes));

                // Refrescar tabla y exportar
                if (typeof cargarProyectos === 'function') cargarProyectos({});
                generarExcel(existentes);

                Swal.fire({
                    title: 'Importación exitosa',
                    html: `Proyecto registrado con ID: <b>${proyecto.id_proyecto}</b>`,
                    icon: 'success',
                    timer: 3000,
                    timerProgressBar: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.reload();
                    }
                });

                } catch (err) {
                    console.error(err);
                    await Swal.fire('Error', err.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        });

        // ————————————————————————————————————————————————
        // 3) Inicializar tabla al cargar la página
        // ————————————————————————————————————————————————
        document.addEventListener('DOMContentLoaded', () => {
            cargarProyectosEnSelector();
            cargarDepartamentos();
            cargarMunicipios();

            // Inicializar selects estáticos
            const staticSelects = document.querySelectorAll('select:not(#municipio)');
            staticSelects.forEach(select => initializeChoices(select));

            // Obtener datos del usuario y proyecto
            const rolUsuario = "{{ session.usuario.rol }}";
            const proyectos = JSON.parse(localStorage.getItem('proyectos')) || [];
            const idProyecto = localStorage.getItem('idProyectoSeleccionado');
            const proyecto = proyectos.find(p => p.id_proyecto === idProyecto);

            // Lista completa de campos exclusivos de arquitecto
            const camposArquitecto = [
                'id_proyecto', 'fecha_creacion', 'tipo_producto', 'rango_proyecto',
                'grupo_riesgo', 'subgrupos[]', 'porcentajes[]', 'tipo_proyecto',
                'nit_grupo_riesgo', 'nit_titular', 'titular_credito',
                'nombre_proyecto', 'tipo_inmuebles', 'segmento', 'ciudad', 'tipodefiducia',
                'fiduciaria', 'gerente', 'arquitecto', 'auxiliar', 'perito',
                'monto_desembolso', 'monto_cpi',
                'monto_lote', 'total_aprobado', 'calificacion_it',
                'costos_financiables', 'valor_lote', 'valor_total_proyecto',
                'meses_programacion', 'total_inmuebles', 'meses_para_venta'
            ];

            if (rolUsuario === 'auxiliar' && proyecto) {
                camposArquitecto.forEach(campo => {
                    const elemento = document.querySelector(`[name="${campo}"]`);
                    if (!elemento) return;

                    // 1. Deshabilitar el select nativo
                    elemento.disabled = true;
                    
                    // 2. Deshabilitar Choices.js si existe
                    if (elemento.choices) {
                        elemento.choices.disable();
                        elemento.choices.init(); // Reiniciar para aplicar cambios
                    }
                    
                    // 3. Bloquear wrapper de Choices
                    const choicesContainer = elemento.closest('.choices');
                    if (choicesContainer) {
                        choicesContainer.style.pointerEvents = 'none';
                        choicesContainer.style.opacity = '0.7';
                    }
                });
            

                // Bloquear campos de subgrupos dinámicos
                const subgrupos = document.querySelectorAll('.subgrupo-input, .porcentaje-input');
                subgrupos.forEach(input => {
                    input.readOnly = true;
                    input.closest('.input-group').querySelector('.btn-add-subgrupo').disabled = true;
                });
            }

            // Precargar ID de proyecto
            const inputHiddenId = document.getElementById('id_proyecto_hidden');
            if (inputHiddenId && idProyecto) inputHiddenId.value = idProyecto;
        });

    // En tu código JS principal, añade este evento:
    document.getElementById('importModal').addEventListener('hidden.bs.modal', function () {
        document.querySelector('[name="grupo_riesgo"]').value = '';
        document.querySelector('[name="auxiliar"]').value = '';
    });

    function getSelectText(selector) {
        try {
            const el = document.querySelector(selector);
            if (!el || el.tagName !== 'SELECT') return '';

            if (el._choicesInstance) {
                const selectedValue = el._choicesInstance.getValue(true);
                const option = Array.from(el.options).find(opt => opt.value == selectedValue);
                return option?.text || '';
            }

            return el.options[el.selectedIndex]?.text || '';
        } catch (error) {
            console.error('Error en getSelectText:', error);
            return '';
        }
    }

    function getFechaBogotaSinZona() {
        const fecha = new Date();
        return fecha.toLocaleString('es-CO', {
            timeZone: 'America/Bogota',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        }).replace(/,/g, ''); // Ejemplo: "14/05/2025 17:30:45"
    }


    function calcularPorcentajeFinanciables() {
        // Obtener valores de campos DESHABILITADOS pero existentes en el DOM
        const totalAprobado = parseFloat(document.querySelector('[name="total_aprobado"]')?.value) || 0;
        const costosFinanciables = parseFloat(document.querySelector('[name="costos_financiables"]')?.value) || 0;
        
        let porcentaje = 0;
        
        if (costosFinanciables > 0) {
            porcentaje = (totalAprobado / costosFinanciables) * 100;
        }
        
        const campoPorcentaje = document.querySelector('[name="porcentaje_solicitado_financiables"]');
        if (campoPorcentaje) campoPorcentaje.value = porcentaje.toFixed(2);
        
        return porcentaje;
    }

    // Función modificada para exportar a Excel
    function obtenerCondicionesAprobacion() {
        return Array.from(document.querySelectorAll('#lista-condiciones .form-check')).map(div => {
            const checkbox = div.querySelector('input[type="checkbox"]');
            const texto = div.querySelector('label').textContent.trim();
            const fecha = checkbox.getAttribute('data-fecha') || '';
            
            return checkbox.checked 
                ? `${texto} - OK (${fecha})` 
                : texto; // Solo texto si no está aprobado
        });
    }

    // 3. Modificar evento change en checkboxes para guardar fecha única
    document.querySelectorAll('#lista-condiciones input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if(this.checked) {
                // Guardar fecha individual al momento de marcar
                const fecha = getFechaBogotaSinZona();
                this.setAttribute('data-fecha', fecha);
                this.disabled = true;
            }
            actualizarBotonSiguiente();
        });
    });

    function actualizarBotonSiguiente() {
        const checkboxes = document.querySelectorAll('#lista-condiciones input[type="checkbox"]');
        const algunCheckeado = Array.from(checkboxes).some(cb => cb.checked);
        document.getElementById('btn-siguiente-paso').disabled = !algunCheckeado;
    }

    // Actualizar event listeners para campos relacionados
    document.querySelectorAll('[name="total_aprobado"], [name="costos_financiables"]').forEach(input => {
        input.addEventListener('input', () => {
            calcularTotalAprobado(); // Función existente
            calcularPorcentajeFinanciables(); // Nueva función
        });
    });

    // Función para obtener el valor del select
    function getSelectValue(selectElement) {
        try {
            if (selectElement._choicesInstance) {
                const selected = selectElement._choicesInstance.getValue(true);
                return Array.isArray(selected) ? selected[0] : selected;
            }
            return selectElement.value;
        } catch (error) {
            console.error('Error obteniendo valor del select:', error);
            return '';
        }
    }

 
    // Función mejorada para obtener el texto del select
    function getSelectedText(selectElement) {
        try {
            if (!selectElement) return "";
            
            // Caso para Choices.js
            if (selectElement._choicesInstance) {
                const selectedValue = selectElement._choicesInstance.getValue(true);
                const selectedOption = selectElement.querySelector(`option[value="${selectedValue}"]`);
                return selectedOption?.textContent || "";
            }
            
            // Caso para selects normales
            return selectElement.options[selectElement.selectedIndex]?.text || "";
            
        } catch (error) {
            console.error("Error obteniendo texto del select:", error);
            return "";
        }
    }

    // Función para validar campos numéricos
    const validarNumericos = (valor, min, max) => {
            const num = parseFloat(valor);
            return !isNaN(num) && num >= min && num <= max;
    };

    // Validaciones en tiempo real
    document.querySelectorAll('[type="number"]').forEach(input => {
            input.addEventListener('blur', function() {
                if(this.dataset.min && this.dataset.max) {
                    if(!validarNumericos(this.value, this.dataset.min, this.dataset.max)) {
                        this.classList.add('alert-required');
                        alert(`Valor debe estar entre ${this.dataset.min} y ${this.dataset.max}`);
                    } else {
                        this.classList.remove('alert-required');
                    }
                }
            });
    });

    
    // Event listeners adicionales
    document.querySelectorAll('[name="monto_desembolso"], [name="monto_cpi"], [name="monto_lote"]').forEach(input => {
        input?.addEventListener('input', calcularTotalAprobado);
    });

    document.getElementById('btn-importar')?.addEventListener('click', () => {
        new bootstrap.Modal(document.getElementById('importModal'))?.show();
    });

    function limpiarFormulario() {
        // Limpiar campos básicos
        document.getElementById('form-crear-proyecto').reset();
        
        // Reiniciar participantes
        document.getElementById('participantes-container').innerHTML = `
            <div class="participante-item">
                <span class="remove-participante"><i class="fas fa-times-circle"></i></span>
                <div class="row">
                    <div class="col-md-5 mb-3">
                        <label class="form-label required-field">Nombre Participante</label>
                        <input type="text" class="form-control" name="participantes[0][nombre]" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required-field">Rol</label>
                        <select class="form-select" name="participantes[0][rol]" required>
                            <option value="">Seleccione un rol</option>
                            <option>Arquitecto</option>
                            <option>Gerente</option>
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label required-field">Participación</label>
                        <div class="input-group">
                            <input type="number" class="form-control" 
                                name="participantes[0][participacion]" required>
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
            </div>`;

        // Limpiar condiciones de aprobación
        const condicionesContainer = document.getElementById('lista-condiciones');
        if(condicionesContainer) {
            condicionesContainer.innerHTML = ''; // Elimina todas las condiciones
        }
        
        // Limpiar input de nueva condición
        const inputCondicion = document.querySelector('#condiciones-container input[type="text"]');
        if(inputCondicion) {
            inputCondicion.value = '';
        }

        // Reiniciar selects especiales
        const reiniciarSelect = (selector) => {
            const select = document.querySelector(selector);
            if (select._choicesInstance) {
                select._choicesInstance.setChoiceByValue('');
                select._choicesInstance.removeActiveItems();
            }
            select.value = '';
        };
        
        reiniciarSelect('[name="departamento"]');
        reiniciarSelect('[name="municipio"]');
        reiniciarSelect('[name="gerente"]');
        reiniciarSelect('[name="arquitecto"]');
        reiniciarSelect('[name="auxiliar"]');
        reiniciarSelect('[name="perito"]');
        
        // Restablecer valores por defecto
        document.querySelector('[name="meses_venta"]').value = 12;
        
        // Volver a inicializar participantes
        participanteCount = 1;
    }

    // Función modificada para agregar condiciones con checkboxes funcionales
    function agregarCondicion(texto = '', esEdicion = false, fecha = '') {
        const input = document.querySelector('#condiciones-container input[type="text"]');
        const lista = document.getElementById('lista-condiciones');
        const condicionTexto = esEdicion ? texto : input.value.trim();

        if (condicionTexto) {
            const div = document.createElement('div');
            div.className = 'form-check d-flex align-items-center mb-2';
            
            // Checkbox
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'form-check-input me-2';
            
            // Manejar estado y fechas
            if (esEdicion && fecha) {
                checkbox.checked = true;
                checkbox.disabled = true; // Bloquear si está aprobado
                checkbox.setAttribute('data-fecha-aprobacion', fecha);
            }
            
            // Evento para cambios en el checkbox
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    const fechaActual = getFechaBogotaSinZona();
                    this.setAttribute('data-fecha-aprobacion', fechaActual);
                    this.disabled = true; // Bloquear al marcar
                }
                actualizarEstadoBoton();
            });

            // Label
            const label = document.createElement('label');
            label.className = 'form-check-label flex-grow-1 me-2';
            label.textContent = condicionTexto;

            // Botones de acción
            const accionesDiv = document.createElement('div');
            accionesDiv.className = 'btn-group';
            
            // Botón Editar
            const btnEditar = document.createElement('button');
            btnEditar.type = 'button';
            btnEditar.className = 'btn btn-sm btn-outline-warning me-1';
            btnEditar.innerHTML = '<i class="fas fa-edit"></i>';
            btnEditar.onclick = () => editarCondicion(div);
            
            // Botón Eliminar
            const btnEliminar = document.createElement('button');
            btnEliminar.type = 'button';
            btnEliminar.className = 'btn btn-sm btn-outline-danger';
            btnEliminar.innerHTML = '<i class="fas fa-trash"></i>';
            btnEliminar.onclick = () => eliminarCondicion(div);

            // Ensamblar elementos
            accionesDiv.appendChild(btnEditar);
            accionesDiv.appendChild(btnEliminar);
            
            div.appendChild(checkbox);  
            div.appendChild(label);
            div.appendChild(accionesDiv);

            if (!esEdicion) {
                lista.appendChild(div);
                input.value = '';
            } else {
                lista.replaceChild(div, lista.children[indexEdicion]);
            }
            
            actualizarEstadoBoton();
        }
    }

    function actualizarEstadoBoton() {
        const checkboxes = document.querySelectorAll('#lista-condiciones input[type="checkbox"]');
        const aprobadas = Array.from(checkboxes).some(cb => cb.checked);
        document.getElementById('btn-siguiente-paso').disabled = !aprobadas;
    }

    let condicionEditando = null;

    function editarCondicion(elementoDiv) {
        const label = elementoDiv.querySelector('label');
        const textoActual = label.textContent;
        
        // Crear campo de edición
        const inputEdit = document.createElement('input');
        inputEdit.type = 'text';
        inputEdit.className = 'form-control me-2';
        inputEdit.value = textoActual;
        
        // Botón Guardar cambios
        const btnGuardar = document.createElement('button');
        btnGuardar.type = 'button';
        btnGuardar.className = 'btn btn-sm btn-success';
        btnGuardar.innerHTML = '<i class="fas fa-save"></i>';
        
        // Reemplazar elementos
        elementoDiv.querySelector('.btn-group').remove();
        label.replaceWith(inputEdit);
        elementoDiv.appendChild(btnGuardar);
        
        btnGuardar.onclick = () => {
            const nuevoTexto = inputEdit.value.trim();
            if (nuevoTexto) {
                label.textContent = nuevoTexto;
                inputEdit.replaceWith(label);
                btnGuardar.remove();
                elementoDiv.appendChild(elementoDiv.querySelector('.btn-group'));
            }
        };
    }

    function eliminarCondicion(elementoDiv) {
            Swal.fire({
                title: 'Error',
                text: '¿Estás seguro de eliminar esta condición?',
                icon: 'error',
                showCancelButton: true,
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    elementoDiv.remove();
                }
                return false;
    });
    }

    // Función para calcular fecha de alerta
    function calcularFechaAlerta() {
        const fechaAprobacion = document.querySelector('[name="fecha_aprobacion"]').value;
        const mesesVigencia = parseInt(document.querySelector('[name="vigencia_en_meses"]').value) || 0;
        const campoAlerta = document.querySelector('[name="alerta_fecha"]');

        if (fechaAprobacion && !isNaN(mesesVigencia)) {
            const fecha = new Date(fechaAprobacion);
            
            // Sumar meses a la fecha de aprobación
            fecha.setMonth(fecha.getMonth() + mesesVigencia);
            
            // Formatear a YYYY-MM-DD
            const fechaAlerta = fecha.toISOString().split('T')[0];
            campoAlerta.value = fechaAlerta;
        } else {
            campoAlerta.value = ''; // Limpiar si no hay datos válidos
        }
    }

    // Event listeners para ambos campos relacionados
    document.querySelector('[name="fecha_aprobacion"]').addEventListener('change', calcularFechaAlerta);
    document.querySelector('[name="vigencia_en_meses"]').addEventListener('input', calcularFechaAlerta);

    </script>
    <!-- Footer Estándar Bancolombia -->
    <div class="footer">
        <div class="container-aligned">
            <p>© 2025 Bancolombia. Todos los derechos reservados.</p>
            <p>
                <a href="#">Términos y condiciones</a> | 
                <a href="#">Política de privacidad</a> | 
                <a href="#">Ayuda</a>
            </p>
            <p>
                <i class="fas fa-phone"></i> Línea de atención: 01 8000 912 345 | 
                <i class="fas fa-map-marker-alt"></i> Sede principal: Medellín, Colombia
            </p>
        </div>
    </div>
</body>
</html>